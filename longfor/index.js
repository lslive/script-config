/**
Title: Longfor 签到打卡
Nomination / Category: QuanmuteX
Written by: lslive
Date: 2025-7-31
Draft Version: 0.1
Contact Info: https://github.com/lslive
Notes: 只测试过圈X，其它环境请自行尝试
*/

/***
const ckName = "longfor";
const key = "longfor_apikey";
*/
var _0xodt='jsjiami.com.v7';const _0x530edb=_0x1ff6;(function(_0x1881ba,_0x16107b,_0x43bd52,_0x3d4a2c,_0xad00a0,_0x559a11,_0xa3f1fa){return _0x1881ba=_0x1881ba>>0x7,_0x559a11='hs',_0xa3f1fa='hs',function(_0x1474bf,_0x4d8469,_0x1710b2,_0xc63c0e,_0x3e97bf){const _0x426695=_0x1ff6;_0xc63c0e='tfi',_0x559a11=_0xc63c0e+_0x559a11,_0x3e97bf='up',_0xa3f1fa+=_0x3e97bf,_0x559a11=_0x1710b2(_0x559a11),_0xa3f1fa=_0x1710b2(_0xa3f1fa),_0x1710b2=0x0;const _0xb880bc=_0x1474bf();while(!![]&&--_0x3d4a2c+_0x4d8469){try{_0xc63c0e=-parseInt(_0x426695(0xb5,'y8&j'))/0x1*(-parseInt(_0x426695(0xd8,'$@ds'))/0x2)+-parseInt(_0x426695(0x95,'^^f)'))/0x3+parseInt(_0x426695(0xc3,'(Oh7'))/0x4+parseInt(_0x426695(0x86,'x&pq'))/0x5*(-parseInt(_0x426695(0x9c,'UsLW'))/0x6)+parseInt(_0x426695(0xc6,'&SCr'))/0x7+parseInt(_0x426695(0x7c,'m!JY'))/0x8*(parseInt(_0x426695(0xd9,'^^f)'))/0x9)+-parseInt(_0x426695(0xce,'Lya3'))/0xa;}catch(_0x3372df){_0xc63c0e=_0x1710b2;}finally{_0x3e97bf=_0xb880bc[_0x559a11]();if(_0x1881ba<=_0x3d4a2c)_0x1710b2?_0xad00a0?_0xc63c0e=_0x3e97bf:_0xad00a0=_0x3e97bf:_0x1710b2=_0x3e97bf;else{if(_0x1710b2==_0xad00a0['replace'](/[bTHCrWpJIQYUgDnVBuhMt=]/g,'')){if(_0xc63c0e===_0x4d8469){_0xb880bc['un'+_0x559a11](_0x3e97bf);break;}_0xb880bc[_0xa3f1fa](_0x3e97bf);}}}}}(_0x43bd52,_0x16107b,function(_0x359e4f,_0x19afd1,_0x3c28c0,_0x59a622,_0x5aed56,_0x5b2956,_0x577ee8){return _0x19afd1='\x73\x70\x6c\x69\x74',_0x359e4f=arguments[0x0],_0x359e4f=_0x359e4f[_0x19afd1](''),_0x3c28c0='\x72\x65\x76\x65\x72\x73\x65',_0x359e4f=_0x359e4f[_0x3c28c0]('\x76'),_0x59a622='\x6a\x6f\x69\x6e',(0x1b27b5,_0x359e4f[_0x59a622](''));});}(0x6200,0x3071c,_0x4d20,0xc6),_0x4d20)&&(_0xodt=0x3f77);function _0x1ff6(_0x195ec9,_0x299d31){const _0x4d202d=_0x4d20();return _0x1ff6=function(_0x1ff6a6,_0x4d2473){_0x1ff6a6=_0x1ff6a6-0x6d;let _0x12db9b=_0x4d202d[_0x1ff6a6];if(_0x1ff6['bCzVBv']===undefined){var _0x5cb6f9=function(_0x5d4980){const _0xaabbec='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x197d4a='',_0x114204='';for(let _0x5174f8=0x0,_0x3e60a2,_0x4943e5,_0xc50e99=0x0;_0x4943e5=_0x5d4980['charAt'](_0xc50e99++);~_0x4943e5&&(_0x3e60a2=_0x5174f8%0x4?_0x3e60a2*0x40+_0x4943e5:_0x4943e5,_0x5174f8++%0x4)?_0x197d4a+=String['fromCharCode'](0xff&_0x3e60a2>>(-0x2*_0x5174f8&0x6)):0x0){_0x4943e5=_0xaabbec['indexOf'](_0x4943e5);}for(let _0x185b44=0x0,_0x187aa0=_0x197d4a['length'];_0x185b44<_0x187aa0;_0x185b44++){_0x114204+='%'+('00'+_0x197d4a['charCodeAt'](_0x185b44)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x114204);};const _0x125900=function(_0x5916e0,_0x2e4e31){let _0x36d7ee=[],_0xb5869a=0x0,_0x13d176,_0x2e3197='';_0x5916e0=_0x5cb6f9(_0x5916e0);let _0x256bf1;for(_0x256bf1=0x0;_0x256bf1<0x100;_0x256bf1++){_0x36d7ee[_0x256bf1]=_0x256bf1;}for(_0x256bf1=0x0;_0x256bf1<0x100;_0x256bf1++){_0xb5869a=(_0xb5869a+_0x36d7ee[_0x256bf1]+_0x2e4e31['charCodeAt'](_0x256bf1%_0x2e4e31['length']))%0x100,_0x13d176=_0x36d7ee[_0x256bf1],_0x36d7ee[_0x256bf1]=_0x36d7ee[_0xb5869a],_0x36d7ee[_0xb5869a]=_0x13d176;}_0x256bf1=0x0,_0xb5869a=0x0;for(let _0x356ade=0x0;_0x356ade<_0x5916e0['length'];_0x356ade++){_0x256bf1=(_0x256bf1+0x1)%0x100,_0xb5869a=(_0xb5869a+_0x36d7ee[_0x256bf1])%0x100,_0x13d176=_0x36d7ee[_0x256bf1],_0x36d7ee[_0x256bf1]=_0x36d7ee[_0xb5869a],_0x36d7ee[_0xb5869a]=_0x13d176,_0x2e3197+=String['fromCharCode'](_0x5916e0['charCodeAt'](_0x356ade)^_0x36d7ee[(_0x36d7ee[_0x256bf1]+_0x36d7ee[_0xb5869a])%0x100]);}return _0x2e3197;};_0x1ff6['welDYp']=_0x125900,_0x195ec9=arguments,_0x1ff6['bCzVBv']=!![];}const _0x2f9c21=_0x4d202d[0x0],_0x44b0c2=_0x1ff6a6+_0x2f9c21,_0x32486f=_0x195ec9[_0x44b0c2];return!_0x32486f?(_0x1ff6['BVPqGL']===undefined&&(_0x1ff6['BVPqGL']=!![]),_0x12db9b=_0x1ff6['welDYp'](_0x12db9b,_0x4d2473),_0x195ec9[_0x44b0c2]=_0x12db9b):_0x12db9b=_0x32486f,_0x12db9b;},_0x1ff6(_0x195ec9,_0x299d31);}const $=new Env(_0x530edb(0xca,'UsLW')),ckName='longfor',key=_0x530edb(0x85,'(Oh7');let userCookie=$[_0x530edb(0xcf,'gB$J')](ckName),apiKey=$['getjson'](key);async function getSignLongforApp(_0x2503f2){const _0x2cc255=_0x530edb,_0x348ea2={'oooWh':'APPKEY','AVsqA':function(_0x4b93de,_0x1ce01){return _0x4b93de===_0x1ce01;},'moolt':function(_0x5e41f4,_0x5a8c2a){return _0x5e41f4!==_0x5a8c2a;},'IYana':_0x2cc255(0xb8,'A7oX'),'nEFyD':_0x2cc255(0x7a,'TuHq'),'cIqZH':function(_0x3c94d4){return _0x3c94d4();}},_0x442b91='https://gw2c-hw-open.longfor.com/lmarketing-task-api-mvc-prod/openapi/task/v1/signature/clock',_0x5c4998={...userCookie,'X-GAIA-API-KEY':apiKey[_0x348ea2[_0x2cc255(0x78,'wa!$')]],'X-LF-Bu-Code':_0x2cc255(0xd1,'daNK'),'X-LF-DXRisk-Source':'5','X-LF-Channel':'C3'},_0x5da724=JSON[_0x2cc255(0xc9,'t8[N')]({'activity_no':_0x2503f2});try{const _0x2ab718=await $['http'][_0x2cc255(0xb9,'VoP]')]({'url':_0x442b91,'headers':_0x5c4998,'body':_0x5da724});_0x348ea2[_0x2cc255(0xb4,'rJ@D')](_0x2ab718[_0x2cc255(0x79,'4G3$')],0xc8)?_0x348ea2[_0x2cc255(0xd5,'EPg2')](_0x348ea2[_0x2cc255(0x70,'y8&j')],_0x348ea2[_0x2cc255(0xbb,'x&pq')])?$[_0x2cc255(0x7f,'hOcx')](_0x2cc255(0xa4,'Fed8')+_0x2ab718[_0x2cc255(0xae,'m!JY')]):_0xaabbec[_0x2cc255(0xd7,'m!JY')](_0x2cc255(0xa2,'^^f)')+_0x197d4a[_0x2cc255(0x91,'y8&j')]):$[_0x2cc255(0x7b,')4WQ')](_0x2cc255(0xad,'K7^]')+_0x2ab718['statusCode']+'\x0a'+_0x2ab718[_0x2cc255(0xb3,'Lya3')]);}catch(_0x3dd02f){$['log'](_0x2cc255(0x89,'4G3$')+_0x3dd02f),await _0x348ea2['cIqZH'](delectCK);}}async function lotteryChance(){const _0x16e3b8=_0x530edb,_0xf422cb={'UQTrZ':'wxkey','tLQLA':_0x16e3b8(0xcc,'o6ei'),'efeId':function(_0x5a6ba8,_0x1576f7){return _0x5a6ba8===_0x1576f7;},'XKuWD':function(_0x46c107,_0x1f9c84){return _0x46c107!==_0x1f9c84;},'bfbMy':_0x16e3b8(0xa0,'&SCr'),'wZrGG':function(_0x9905df){return _0x9905df();}},_0x3128c6=_0x16e3b8(0xa9,'WsNA'),_0x3b0bd3={...userCookie,'x-gaia-api-key':apiKey[_0xf422cb[_0x16e3b8(0xdb,'hOcx')]],'bucode':_0x16e3b8(0xb6,'wa!$'),'channel':'C3','X-LF-DXRisk-Source':'5'},_0x8a126f={'component_no':_0xf422cb['tLQLA'],'activity_no':_0x16e3b8(0xc8,'tAql')};try{const _0x253a5a=await $[_0x16e3b8(0xc5,'o6ei')]['get']({'url':_0x3128c6,'headers':_0x3b0bd3,'searchParams':_0x8a126f});if(_0xf422cb[_0x16e3b8(0x99,'(Oh7')](_0x253a5a['statusCode'],0xc8))$[_0x16e3b8(0x84,'K7^]')]('✅\x20请求成功:\x20'+_0x253a5a[_0x16e3b8(0xbe,'o6ei')]);else{if(_0xf422cb[_0x16e3b8(0x9a,'O$zq')](_0xf422cb['bfbMy'],'cRziG'))return _0x57b2b0['log']('❌请先获取\x20CK');else $[_0x16e3b8(0x93,'eGV1')](_0x16e3b8(0x6e,'O$zq')+_0x253a5a[_0x16e3b8(0xc2,'FxY4')]+'\x0a'+_0x253a5a[_0x16e3b8(0x91,'y8&j')]);}}catch(_0x2564f8){$[_0x16e3b8(0x93,'eGV1')](_0x16e3b8(0xd2,'wa!$')+_0x2564f8),await _0xf422cb[_0x16e3b8(0xda,'JShz')](delectCK);}}async function lotteryClick(){const _0x3d2103=_0x530edb,_0x22f599={'OFouy':_0x3d2103(0x76,'TNOH'),'gMeiU':_0x3d2103(0x97,'W@M!'),'wSMfd':function(_0x164b67,_0x5d822e){return _0x164b67===_0x5d822e;},'WbosC':_0x3d2103(0x6f,'WM]5'),'mGaAM':function(_0x2b24ff){return _0x2b24ff();}},_0x161838=_0x3d2103(0x94,'UsLW'),_0x2323cb={...userCookie,'x-gaia-api-key':apiKey['wxkey'],'bucode':_0x3d2103(0x98,'qnj%'),'channel':'C3','X-LF-DXRisk-Source':'5'},_0x21b28d=JSON[_0x3d2103(0x6d,'Pre9')]({'component_no':_0x22f599['OFouy'],'activity_no':_0x22f599[_0x3d2103(0x96,'lAu(')],'batch_no':''});try{const _0xf1e1a5=await $[_0x3d2103(0x8d,')4WQ')][_0x3d2103(0x72,'y8&j')]({'url':_0x161838,'headers':_0x2323cb,'body':_0x21b28d});_0x22f599[_0x3d2103(0xac,'tAql')](_0xf1e1a5[_0x3d2103(0xb0,'lf*T')],0xc8)?$[_0x3d2103(0x9f,'&SCr')](_0x3d2103(0xa2,'^^f)')+_0xf1e1a5['body']):$['log']('⚠️\x20请求失败:\x20'+_0xf1e1a5[_0x3d2103(0x7d,'PeYm')]+'\x0a'+_0xf1e1a5[_0x3d2103(0x82,'lAu(')]);}catch(_0x4ea48f){_0x22f599[_0x3d2103(0x71,'hOcx')]===_0x3d2103(0xaa,'&SCr')?($['log'](_0x3d2103(0xd3,'$@ds')+_0x4ea48f),await _0x22f599[_0x3d2103(0xd0,'daNK')](delectCK)):_0x567665['done']();}}async function delectCK(){const _0x512b44=_0x530edb;$[_0x512b44(0xb7,'daNK')](null,ckName),$[_0x512b44(0x8f,'!Lb4')](null,key);}function _0x4d20(){const _0x7e9933=(function(){return[_0xodt,'UITQjsupjigJBanbmbi.CcomH.tvpD7YWDVMgBrh==','pCo4W6tdJG','ua1ze000W64','vIzuzq','WRSoWOhcI17dU8kPW7FcMfVcLmkDW7xcPumqdmkZW6ldOCoEW7/cGHL7W4FcSgyfW5O','mCo3W7KHW4ddG8kStW43rg3cNSoouHW','CmoSW5C9ed8YWPfcW5G','WQ8fixX1','WQKkWPdcK0ldQ8klW6ZcLve','emkqW57dMIW','W47cRti','xw1wqmoZWQpcPa','C8oBoCo7vHG8W7/dSSkM','W7pcTCk0CCk+','WPyXia','i0HZWQddKq','WPa0W60','sCorfbq','hmoFW7ZdM8oH','tWDk','sh55nmoYW7xcNmo0rmotWR5tAmk1','W5/cOCocg8orWOuDDM0','WQvSzeCzg3zgW5joWR0yv8kQxCkXWRDrWRyUb0hdK8oilrHfxZVdI8kPWO1kW78OsW','WOWZjdLn','4P6wxUISHUAYPEMuRUITT8oO6k205PIf5PAeWRNdUCkLW7y','W5xcOZW8','W6JcKCkkvCkFkxj/W6K','W57dRvbsCM3cJwvSW57cTa','W4RcTIe4','WQ8Yp01N','pwuBW43dPGFcVG','W6hcRtOJCXK','l8o4W7pdGW','b8krWPKQWR9xzq','kmkcBW','W53cSeqfWQFdLM/cJWhdHmkFW73cTWtdKbpcTrhcRmkeW4T1lrbay2VcLL/dSYlcNCovWR5NuCoFBSovrSkRdCkgpCopW6hcOsDyWOpcJ8kVW6ZcKrpdVhddMbVcKSodWO9XaSoytehcN8ksBgLfW73cQXhdRJi1tgnPh8kPWOi','W6DNsCkCgd7cMmkKo8kjvSkdaa'].concat((function(){return['tmoZfqtcVG','WRm9q2tcOvKCW7TeWPb6W6pdLmkgnuy','CmkdW6T2WOvv','qxDYgSoW','rfJcGSouW4y','WOddTmkAoa','WOldTqjhWR/cQZFdLIZdKq','4P6w6k6j5yA56i2q5y+HWRJcI8oi','W446WRhdJHy','W6W8W7O','W6mbW6FdU8kU','iLv3WQZdKG','4P+tDUIUIUAZQEAiSEwkL8kxW4u','vdiEiSkYW7xdGqKlE3SPAW3cTbD+WO8oW4pcQCoWWPjrpCkVfSknWQtdKqCl','4PY8ioIVMoAZTEAkHUwiJmkrya','r8o7WRasW70','jSkNqCkbWO0','ECoWW7LuW4KVa8oUcCoiWPK4WQ8','c8kqzSk5','W7dcPuhcVSopkLtdGNRcG8omuuldHSkOe8osW40tW7VdQCoswub+gc7dUuz4WP8ZchdcSmoCcWzGW7KNlSo0cmo5W4KOW7dcQrWHE35fWPZcTN5eW6FcTCkPsxhcLSk7hZRdUHawg3/dTblcHgJcUSooWOimWP05WO3cJ1C','W60DW5VdV8kE','WQRcKCoRyNdcR2C','vHrWD8o1','4PQd77MNdEIUJUAXVowLQUI2Pu5U','b2XlAG','W7jUzHquhxzdWP1mW6eEw8oJc8kXWRGeWQ0OvehdKCoCDXjfcJBdHCo5WO8','BaNdUfFcJsbbACocfG','6i6R5y+a562r5yI1W7bBWRyTEfpMIOBLIilWQ7YS','pNuCW48','bSk4qmkc','kauiDmk8','FmkJWQxcImkNWOy0hXCexa','WOnzFH8TW6O','uCk1yL45WQyq','WR5WFfldJG','l2TJcG','WOOnh3f6','WOddKmkXjmoB'].concat((function(){return['W6DNtmkAedNcNmouA8omc8o2CJdcGSozDCk3cwLQFwj0fsetWQ3dHrLsW50','CeVcGmoNW6O','hSkEA8k0','mCkKqCkjW43dIcP6uK4','W5CckbNcRSkKtmo2c1noaG','WR4rWP/cGG','B2joCCogr8kAkxvt','fseUzmkKWQ7dNSozu8oLWQbPxq','jh3cJSoqW7ldHCkB','fmkfE8k9','WRvKWQVcQ8oDB8otASoKBmoU','W53cPCooB8kSW5baEMy4WOL8lG','ybCpjmoFA3xdTJpcLc8SW49vBr4','WO8VW7JdQtpcJSo2W4JdUG','W7NcQ14sWRlcGZlcGoESMowkG+AlVUwpVW','i3mi','p8odpSo7WOboi8kxraH7WRmbf8koW4y','khNcNSocW4BdHSk+','v8oUfmoiW5NcUqXPwvVdLCkP','WQWJhbHKW6T9','t8kxD3uh','yCoJjGb6W7O','4P6msUIUUEAXQEMuHoISTG7ORiJMMAVMLAFcO8kytCkh','4PYfW57OR5hMSihPLjxORkpcO+IUQ+AyV+AwM8kmFSkqW4i','wCkueX5lC8ou','W59DEv3dJG','WPyuW4NcH3q','cwXi','FCkutWjiWQJdSG','W6vMrmkzeJJcNmkbo8kVv8kcfa','W604WOZdNrO','WQ8pe8oHWQy','tmkjdXzjEmoej8kE','4PQ877ICW5FORBtMS4dLPPpOT6PWW4u','BLpcTmkXWQW','bmooW7BdLmoX','WQ08kmoGWR8'];}()));}()));}());_0x4d20=function(){return _0x7e9933;};return _0x4d20();};async function getCookie(){const _0x689df5=_0x530edb,_0x228aff={'tKkPH':'headers','lXwdh':'X-LF-DXRisk-Token','tWfxv':_0x689df5(0x90,')4WQ'),'GuLKZ':_0x689df5(0x75,'4G3$'),'QHkaq':_0x689df5(0xb1,'FxY4')};if($request&&$request['method']!=_0x689df5(0x92,'vYo1')){const _0x4d2c25=$request[_0x228aff['tKkPH']][_0x228aff[_0x689df5(0xbd,'O$zq')]],_0x56e1cd=$request[_0x228aff[_0x689df5(0xa5,'qnj%')]][_0x689df5(0xbf,'Lya3')]||'Mozilla/5.0\x20(iPhone;\x20CPU\x20iPhone\x20OS\x2018_5\x20like\x20Mac\x20OS\x20X)\x20AppleWebKit/605.1.15\x20(KHTML,\x20like\x20Gecko)\x20Mobile/15E148',_0x2bb71c=$request['headers'][_0x228aff['tWfxv']],_0x55d86e=$request[_0x228aff['tKkPH']]['X-LF-UserToken'],_0x297a7c=_0x689df5(0xaf,'VzC5'),_0x3ed620=_0x689df5(0x87,'VzC5'),_0x1fa0fe='2f9e3889-91d9-4684-8ff5-24d881438eaf';$[_0x689df5(0x73,'K7^]')]({'X-LF-DXRisk-Token':_0x4d2c25,'Content-Type':_0x228aff[_0x689df5(0x88,'gB$J')],'User-Agent':_0x56e1cd,'X-LF-UserToken':_0x55d86e,'Cookie':_0x2bb71c,'authtoken':_0x297a7c},ckName),$['setjson']({'APPKEY':_0x3ed620,'wxkey':_0x1fa0fe},key),$[_0x689df5(0xcb,'!Lb4')]($[_0x689df5(0x9b,'x&pq')],'',_0x228aff[_0x689df5(0x83,'y8&j')]);}$['done']();}(async()=>{const _0x5267ee=_0x530edb,_0x37ea95={'Bpezm':function(_0x4397f8,_0x2b48d1){return _0x4397f8!=_0x2b48d1;},'bvNJu':_0x5267ee(0x8b,'@qLL'),'BWHBb':function(_0x25d0c0){return _0x25d0c0();},'oXqfz':function(_0x53ca87,_0x4a8930){return _0x53ca87||_0x4a8930;},'JgQZg':'TXOTK','nJZAG':function(_0x217811,_0x2d54bd){return _0x217811(_0x2d54bd);},'YJTSu':_0x5267ee(0xa3,'m!JY'),'NTBUf':_0x5267ee(0xbc,'^^f)'),'RqQrY':function(_0x82b79a){return _0x82b79a();},'OIFYe':function(_0xbc8a31){return _0xbc8a31();}};if(_0x37ea95[_0x5267ee(0xa6,'Lya3')](typeof $request,_0x37ea95['bvNJu'])){await _0x37ea95['BWHBb'](getCookie);return;}if(_0x37ea95[_0x5267ee(0x8e,'wa!$')](!userCookie,!apiKey)){if(_0x5267ee(0x9e,'JShz')===_0x37ea95[_0x5267ee(0xba,'wa!$')])return $['log'](_0x5267ee(0x9d,'4G3$'));else _0x2f756d[_0x5267ee(0x81,'t8[N')]('✅\x20请求成功:\x20'+_0x5a14d3['body']);}await _0x37ea95[_0x5267ee(0x7e,'@qLL')](getSignLongforApp,_0x37ea95['YJTSu']),await $[_0x5267ee(0xa8,'o6ei')](0x3e8),await getSignLongforApp(_0x37ea95[_0x5267ee(0x80,'u$qo')]),await $[_0x5267ee(0x74,'tAql')](0x3e8),await _0x37ea95[_0x5267ee(0xd6,'yJXG')](lotteryChance),await $[_0x5267ee(0x8a,')4WQ')](0x3e8),await _0x37ea95[_0x5267ee(0xa1,'u$qo')](lotteryClick);})()['catch'](_0xda7148=>$['notifyMsg'][_0x530edb(0xb2,'!Lb4')](_0xda7148[_0x530edb(0xab,'U]we')]||_0xda7148))[_0x530edb(0xd4,'Pre9')](async()=>{const _0x53a10a=_0x530edb;$[_0x53a10a(0xc1,'4G3$')]();});var version_ = 'jsjiami.com.v7';



function Env(e,t){class s{constructor(e){this.env=e}send(e,t="GET"){e="string"==typeof e?{url:e}:e;let s=this.get;"POST"===t&&(s=this.post);const i=new Promise(((t,i)=>{s.call(this,e,((e,s,o)=>{e?i(e):t(s)}))}));return e.timeout?((e,t=1e3)=>Promise.race([e,new Promise(((e,s)=>{setTimeout((()=>{s(new Error("请求超时"))}),t)}))]))(i,e.timeout):i}get(e){return this.send.call(this.env,e)}post(e){return this.send.call(this.env,e,"POST")}}return new class{constructor(e,t){this.logLevels={debug:0,info:1,warn:2,error:3},this.logLevelPrefixs={debug:"[DEBUG] ",info:"[INFO] ",warn:"[WARN] ",error:"[ERROR] "},this.logLevel="info",this.name=e,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,t),this.log("",`🔔${this.name}, 开始!`)}getEnv(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":void 0}isNode(){return"Node.js"===this.getEnv()}isQuanX(){return"Quantumult X"===this.getEnv()}isSurge(){return"Surge"===this.getEnv()}isLoon(){return"Loon"===this.getEnv()}isShadowrocket(){return"Shadowrocket"===this.getEnv()}isStash(){return"Stash"===this.getEnv()}toObj(e,t=null){try{return JSON.parse(e)}catch{return t}}toStr(e,t=null,...s){try{return JSON.stringify(e,...s)}catch{return t}}getjson(e,t){let s=t;if(this.getdata(e))try{s=JSON.parse(this.getdata(e))}catch{}return s}setjson(e,t){try{return this.setdata(JSON.stringify(e),t)}catch{return!1}}getScript(e){return new Promise((t=>{this.get({url:e},((e,s,i)=>t(i)))}))}runScript(e,t){return new Promise((s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let o=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");o=o?1*o:20,o=t&&t.timeout?t.timeout:o;const[r,a]=i.split("@"),n={url:`http://${a}/v1/scripting/evaluate`,body:{script_text:e,mock_type:"cron",timeout:o},headers:{"X-Key":r,Accept:"*/*"},policy:"DIRECT",timeout:o};this.post(n,((e,t,i)=>s(i)))})).catch((e=>this.logErr(e)))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),i=!s&&this.fs.existsSync(t);if(!s&&!i)return{};{const i=s?e:t;try{return JSON.parse(this.fs.readFileSync(i))}catch(e){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),i=!s&&this.fs.existsSync(t),o=JSON.stringify(this.data);s?this.fs.writeFileSync(e,o):i?this.fs.writeFileSync(t,o):this.fs.writeFileSync(e,o)}}lodash_get(e,t,s){const i=t.replace(/\[(\d+)\]/g,".$1").split(".");let o=e;for(const e of i)if(o=Object(o)[e],void 0===o)return s;return o}lodash_set(e,t,s){return Object(e)!==e||(Array.isArray(t)||(t=t.toString().match(/[^.[\]]+/g)||[]),t.slice(0,-1).reduce(((e,s,i)=>Object(e[s])===e[s]?e[s]:e[s]=Math.abs(t[i+1])>>0==+t[i+1]?[]:{}),e)[t[t.length-1]]=s),e}getdata(e){let t=this.getval(e);if(/^@/.test(e)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(e),o=s?this.getval(s):"";if(o)try{const e=JSON.parse(o);t=e?this.lodash_get(e,i,""):t}catch(e){t=""}}return t}setdata(e,t){let s=!1;if(/^@/.test(t)){const[,i,o]=/^@(.*?)\.(.*?)$/.exec(t),r=this.getval(i),a=i?"null"===r?null:r||"{}":"{}";try{const t=JSON.parse(a);this.lodash_set(t,o,e),s=this.setval(JSON.stringify(t),i)}catch(t){const r={};this.lodash_set(r,o,e),s=this.setval(JSON.stringify(r),i)}}else s=this.setval(e,t);return s}getval(e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(e);case"Quantumult X":return $prefs.valueForKey(e);case"Node.js":return this.data=this.loaddata(),this.data[e];default:return this.data&&this.data[e]||null}}setval(e,t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(e,t);case"Quantumult X":return $prefs.setValueForKey(e,t);case"Node.js":return this.data=this.loaddata(),this.data[t]=e,this.writedata(),!0;default:return this.data&&this.data[t]||null}}initGotEnv(e){this.got=this.got?this.got:require("got").got,this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,e&&(e.headers=e.headers?e.headers:{},e&&(e.headers=e.headers?e.headers:{},void 0===e.headers.cookie&&void 0===e.headers.Cookie&&void 0===e.cookieJar&&(e.cookieJar=this.ckjar)))}get(e,t=(()=>{})){switch(e.headers&&(delete e.headers["Content-Type"],delete e.headers["Content-Length"],delete e.headers["content-type"],delete e.headers["content-length"]),e.params&&(e.url+="?"+this.queryStr(e.params)),void 0===e.followRedirect||e.followRedirect||((this.isSurge()||this.isLoon())&&(e["auto-redirect"]=!1),this.isQuanX()&&(e.opts?e.opts.redirection=!1:e.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(e,((e,s,i)=>{!e&&s&&(s.body=i,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),t(e,s,i)}));break;case"Quantumult X":this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then((e=>{const{statusCode:s,statusCode:i,headers:o,body:r,bodyBytes:a}=e;t(null,{status:s,statusCode:i,headers:o,body:r,bodyBytes:a},r,a)}),(e=>t(e&&e.error||"UndefinedError")));break;case"Node.js":let s=require("iconv-lite");this.initGotEnv(e),this.got(e).on("redirect",((e,t)=>{try{if(e.headers["set-cookie"]){const s=e.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),t.cookieJar=this.ckjar}}catch(e){this.logErr(e)}})).then((e=>{const{statusCode:i,statusCode:o,headers:r,rawBody:a}=e,n=s.decode(a,this.encoding);t(null,{status:i,statusCode:o,headers:r,rawBody:a,body:n},n)}),(e=>{const{message:i,response:o}=e;t(i,o,o&&s.decode(o.rawBody,this.encoding))}));break}}post(e,t=(()=>{})){const s=e.method?e.method.toLocaleLowerCase():"post";switch(e.body&&e.headers&&!e.headers["Content-Type"]&&!e.headers["content-type"]&&(e.headers["content-type"]="application/x-www-form-urlencoded"),e.headers&&(delete e.headers["Content-Length"],delete e.headers["content-length"]),void 0===e.followRedirect||e.followRedirect||((this.isSurge()||this.isLoon())&&(e["auto-redirect"]=!1),this.isQuanX()&&(e.opts?e.opts.redirection=!1:e.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient[s](e,((e,s,i)=>{!e&&s&&(s.body=i,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),t(e,s,i)}));break;case"Quantumult X":e.method=s,this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then((e=>{const{statusCode:s,statusCode:i,headers:o,body:r,bodyBytes:a}=e;t(null,{status:s,statusCode:i,headers:o,body:r,bodyBytes:a},r,a)}),(e=>t(e&&e.error||"UndefinedError")));break;case"Node.js":let i=require("iconv-lite");this.initGotEnv(e);const{url:o,...r}=e;this.got[s](o,r).then((e=>{const{statusCode:s,statusCode:o,headers:r,rawBody:a}=e,n=i.decode(a,this.encoding);t(null,{status:s,statusCode:o,headers:r,rawBody:a,body:n},n)}),(e=>{const{message:s,response:o}=e;t(s,o,o&&i.decode(o.rawBody,this.encoding))}));break}}time(e,t=null){const s=t?new Date(t):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let t in i)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?i[t]:("00"+i[t]).substr((""+i[t]).length)));return e}queryStr(e){let t="";for(const s in e){let i=e[s];null!=i&&""!==i&&("object"==typeof i&&(i=JSON.stringify(i)),t+=`${s}=${i}&`)}return t=t.substring(0,t.length-1),t}msg(t=e,s="",i="",o={}){const r=e=>{const{$open:t,$copy:s,$media:i,$mediaMime:o}=e;switch(typeof e){case void 0:return e;case"string":switch(this.getEnv()){case"Surge":case"Stash":default:return{url:e};case"Loon":case"Shadowrocket":return e;case"Quantumult X":return{"open-url":e};case"Node.js":return}case"object":switch(this.getEnv()){case"Surge":case"Stash":case"Shadowrocket":default:{const r={};let a=e.openUrl||e.url||e["open-url"]||t;a&&Object.assign(r,{action:"open-url",url:a});let n=e["update-pasteboard"]||e.updatePasteboard||s;n&&Object.assign(r,{action:"clipboard",text:n});let h=e.mediaUrl||e["media-url"]||i;if(h){let e,t;if(h.startsWith("http"));else if(h.startsWith("data:")){const[s]=h.split(";"),[,i]=h.split(",");e=i,t=s.replace("data:","")}else{e=h,t=(e=>{const t={JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"};for(var s in t)if(0===e.indexOf(s))return t[s];return null})(h)}Object.assign(r,{"media-url":h,"media-base64":e,"media-base64-mime":o??t})}return Object.assign(r,{"auto-dismiss":e["auto-dismiss"],sound:e.sound}),r}case"Loon":{const s={};let o=e.openUrl||e.url||e["open-url"]||t;o&&Object.assign(s,{openUrl:o});let r=e.mediaUrl||e["media-url"]||i;return r&&Object.assign(s,{mediaUrl:r}),console.log(JSON.stringify(s)),s}case"Quantumult X":{const o={};let r=e["open-url"]||e.url||e.openUrl||t;r&&Object.assign(o,{"open-url":r});let a=e.mediaUrl||e["media-url"]||i;a&&Object.assign(o,{"media-url":a});let n=e["update-pasteboard"]||e.updatePasteboard||s;return n&&Object.assign(o,{"update-pasteboard":n}),console.log(JSON.stringify(o)),o}case"Node.js":return}default:return}};if(!this.isMute)switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(t,s,i,r(o));break;case"Quantumult X":$notify(t,s,i,r(o));break;case"Node.js":break}if(!this.isMuteLog){let e=["","==============📣系统通知📣=============="];e.push(t),s&&e.push(s),i&&e.push(i),console.log(e.join("\n")),this.logs=this.logs.concat(e)}}debug(...e){this.logLevels[this.logLevel]<=this.logLevels.debug&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.debug}${e.map((e=>e??String(e))).join(this.logSeparator)}`))}info(...e){this.logLevels[this.logLevel]<=this.logLevels.info&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.info}${e.map((e=>e??String(e))).join(this.logSeparator)}`))}warn(...e){this.logLevels[this.logLevel]<=this.logLevels.warn&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.warn}${e.map((e=>e??String(e))).join(this.logSeparator)}`))}error(...e){this.logLevels[this.logLevel]<=this.logLevels.error&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.error}${e.map((e=>e??String(e))).join(this.logSeparator)}`))}log(...e){e.length>0&&(this.logs=[...this.logs,...e]),console.log(e.map((e=>e??String(e))).join(this.logSeparator))}logErr(e,t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:this.log("",`❗️${this.name}, 错误!`,t,e);break;case"Node.js":this.log("",`❗️${this.name}, 错误!`,t,void 0!==e.message?e.message:e,e.stack);break}}wait(e){return new Promise((t=>setTimeout(t,e)))}done(e={}){const t=((new Date).getTime()-this.startTime)/1e3;switch(this.log("",`🔔${this.name}, 结束! 🕛 ${t} 秒`),this.log(),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:$done(e);break;case"Node.js":process.exit(1)}}}(e,t)}