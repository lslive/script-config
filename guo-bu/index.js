/**
Title: Longfor 国补
Nomination / Category: Surge、QuantumultX、Loon、Shadowrocket、Node.js
Written by: lslive
Date: 2025-7-31
Draft Version: 0.1
Contact Info: https://github.com/lslive
Notes: 只测试过圈X，其它环境请自行尝试
*/
var _0xodb='jsjiami.com.v7';const _0x5d2700=_0x1596;(function(_0x56d48c,_0x173798,_0x3253ec,_0x3eacbd,_0x5534ce,_0x32b0d9,_0x4f28f1){return _0x56d48c=_0x56d48c>>0x3,_0x32b0d9='hs',_0x4f28f1='hs',function(_0x42911b,_0x179cbc,_0x3acede,_0x432080,_0x360741){const _0x5802e3=_0x1596;_0x432080='tfi',_0x32b0d9=_0x432080+_0x32b0d9,_0x360741='up',_0x4f28f1+=_0x360741,_0x32b0d9=_0x3acede(_0x32b0d9),_0x4f28f1=_0x3acede(_0x4f28f1),_0x3acede=0x0;const _0x5f4fb9=_0x42911b();while(!![]&&--_0x3eacbd+_0x179cbc){try{_0x432080=-parseInt(_0x5802e3(0x199,'Gw6@'))/0x1+-parseInt(_0x5802e3(0x192,'2psO'))/0x2+parseInt(_0x5802e3(0x173,'FmzE'))/0x3*(-parseInt(_0x5802e3(0x1a9,'#E@P'))/0x4)+parseInt(_0x5802e3(0x17e,'PBY*'))/0x5+-parseInt(_0x5802e3(0x198,'q6eW'))/0x6+-parseInt(_0x5802e3(0x163,'Ea!&'))/0x7+parseInt(_0x5802e3(0x1a3,'ziWo'))/0x8;}catch(_0x415f97){_0x432080=_0x3acede;}finally{_0x360741=_0x5f4fb9[_0x32b0d9]();if(_0x56d48c<=_0x3eacbd)_0x3acede?_0x5534ce?_0x432080=_0x360741:_0x5534ce=_0x360741:_0x3acede=_0x360741;else{if(_0x3acede==_0x5534ce['replace'](/[EYGbnXLUWutlVKQgOBJDd=]/g,'')){if(_0x432080===_0x179cbc){_0x5f4fb9['un'+_0x32b0d9](_0x360741);break;}_0x5f4fb9[_0x4f28f1](_0x360741);}}}}}(_0x3253ec,_0x173798,function(_0x3fb9b8,_0x3f0d8b,_0x166171,_0x2b5776,_0x782811,_0x4c99dd,_0x5f1f6b){return _0x3f0d8b='\x73\x70\x6c\x69\x74',_0x3fb9b8=arguments[0x0],_0x3fb9b8=_0x3fb9b8[_0x3f0d8b](''),_0x166171='\x72\x65\x76\x65\x72\x73\x65',_0x3fb9b8=_0x3fb9b8[_0x166171]('\x76'),_0x2b5776='\x6a\x6f\x69\x6e',(0x1b27b4,_0x3fb9b8[_0x2b5776](''));});}(0x640,0x9e4c1,_0x4736,0xca),_0x4736)&&(_0xodb=`\x0a1`);const $=new Env(_0x5d2700(0x179,'ocDc')),ckName=_0x5d2700(0x19d,'gwh2');function _0x4736(){const _0x53a45c=(function(){return[_0xodb,'XGKujDsjYtLinaUmlib.dBcuoWEumQu.KJvOVQ7g==','pqfzWRS','p8kHb1n1','oCkoqSkK','W63cOCkbywTJWO7dICk8DCknW5hcIW','W6momWnuWQv6','jSoQfMLFW50iW4hdNCopvduLcSksWR1kW67cRaNcQJ4IW5RcTXDluSoHt8k7vX0jvafJB0xdUmoHW4GMW63dIwZdRCojW7LPsvydW4nL','W53cPCoMWORcVG','WP0HDq','emogBg5Q','EHpcMqNcGWBdImo9WRe','WQvNWQ/cVq','rYldTmkLxSksmSo3smkctcmy','4PU177M6dEISVoAYMowLQUI2Reqb','g8o8uu9C','WOSKW4ldT8kc','W457v8owFWKWCSka','WQOCyH0','WQBdHKpcVCoDcSkuWQDzW6ddM8om','WQBdISkHW5tdGqBdT8k9txtdPGi','W7iiW57cV8kxW5xdHSoVsG','6zAo6kYA6i+m5y2y566t5yImWPdcINNdImo0W4pLPOxOT5y','W7ZdPqemaG','gxVdJmokEM3dUbRdOq','sCk7A8oiW6C','4PYb6k+25yEj6i675y6HeCkbzq','F2jbW6hcMG','WRi+D8kkuColWO4','oSkCsa'].concat((function(){return['W6NdG3SCWOpcPadcNmk+fx/cGW59','i1zRW5/cHZeqWPnAbIRcHmo7WO/cQha','4P2N6k695ywF6i2w5y+Re09B','WOuxDCkKaq','leFdRq','g8kIl29M','WOPXzG8UWQVdKglcIqm','gNOVW5vSCezCW5OT','6i625y2x562K5yM1W4PXswjalUAlRowlJFcrVz8','WQ9PWQZcVq','6zwm6kYa6i+j5y+a562s5yQkkZ3dVmofW5i/5AsL6lEK','zSogWQSVWRGklHPTvW','gIu3W7m','FvL6fxW','WO9qW4dcRvzTsa','h8o+fSk+W7K','WQ/cNsvbW5W','W5JdKWisaG','W5BdIaaymW','WQtcVwhdQq','gbNdGYFdIa','jeFdPmkc','deddKSkPsq','FJxcUtTaa8o7xJTlWR7dVum','6zsf6k+g6i695y6n562T5yI2W557W4TdACoI5AAO6lwA','iSoXbq','sSoTBs1P','WOSjoa','wrRdJ8oFmq','gbbfWQlcVa'].concat((function(){return['kCo7fNnFWOHj','W7ZcImo1WQhcMG','WQ/dT8oDhJK','B8oGDYa','lmoXbMa','WQRcGCkwl8of','WRinW6JdR8kntW','EZhdGSoOjG','j8khW75OW7HlwsD7shZdPmkO','W7i+W7hdOqPSoCkVFSkO','W67cSrxdMSkN','o8oWbNXkWO5jWOVdIG','fCozCKu','WRvSW7ZcSeO','W6upW5tcTmkx','5lMe6zwc5lQNW7lLMRNOOj8','DLbLW6BcICkkcZOLWRW','W6BcOmknmGGjFG','WPufvSkraq','WR3dJr7cTIeicW','WQfjW5mYWRqYW7NcOCoWw3VdVmk6','fmkaqmkQdve','wL1zp0S','DmoBwZnh','ffZcJCoNoa','W6ZdLXRdVmkixCkqWOPYW4BcV8kCWPBdHCk7W5RdS8kAhub0jb3cRXJdNN4AvmoAW6ncWRLRW77dMhlcK0Huot0yn8o9xe7dNqSHoYD2W4zfvdHWWRddJvZdGmo6W6FdSCotvG3dTCkdWOTBDrz8j8kGgWauW6v0W74MW6RcV8omvahcNmkUW5VdT8kzECkPg1xcTa3dLYNdGrvGfxxcUSkKEWJdJX/dQComlSkIWRlcR8o+sa7dHuJdTL18C8k8WR7dUWNdMqFcSahdHhbKFSogpMuBlfPxW5OKW7tcQeJcNNlcOxpdT8oQEmoqeY/dOmo+jeOrBmkyW6hcM2WXW5uYW6tcPb7dPmoCW7/dO8oDs23cJmkcWPRdUXlcGmkiW4LYWORdMgbl','W7VcMHW','ASoezchdMxTZ','WRCaDG'];}()));}()));}());_0x4736=function(){return _0x53a45c;};return _0x4736();};let userCookie=$[_0x5d2700(0x16a,'^Tn!')](ckName);const urlYSF=_0x5d2700(0x18c,'^Tn!');function headerData(){const _0x5e98e2=_0x5d2700,_0x5e309c={'sdiLe':_0x5e98e2(0x196,'&Lq!'),'LhXNt':_0x5e98e2(0x19a,'@SlD'),'NMQyJ':_0x5e98e2(0x15c,'ziWo'),'KaWrX':_0x5e98e2(0x170,'BaUV')};return{'Content-Type':_0x5e98e2(0x1a4,'Ux!M'),'User-Agent':userCookie[_0x5e309c[_0x5e98e2(0x16c,'6uQx')]],'channelNo':userCookie[_0x5e309c[_0x5e98e2(0x162,'gwh2')]],'token':userCookie[_0x5e309c[_0x5e98e2(0x1a8,'ImH&')]],'Cookie':userCookie[_0x5e309c[_0x5e98e2(0x15e,'BDz]')]],'Referer':'https://scene.cup.com.cn/gsp_front/2025/index?appNo=YJHX044025048&channelNo=Q000101','appNo':userCookie[_0x5e98e2(0x18f,'!Qzl')]};}function _0x1596(_0x4c2357,_0x1ff032){const _0x473631=_0x4736();return _0x1596=function(_0x159604,_0x3b24e1){_0x159604=_0x159604-0x154;let _0x15fbc1=_0x473631[_0x159604];if(_0x1596['uLPbqo']===undefined){var _0x5c32eb=function(_0x28ee10){const _0xa1b43f='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x2a68ab='',_0x296033='';for(let _0x5c291f=0x0,_0x1e6b17,_0x24d266,_0x4d70a3=0x0;_0x24d266=_0x28ee10['charAt'](_0x4d70a3++);~_0x24d266&&(_0x1e6b17=_0x5c291f%0x4?_0x1e6b17*0x40+_0x24d266:_0x24d266,_0x5c291f++%0x4)?_0x2a68ab+=String['fromCharCode'](0xff&_0x1e6b17>>(-0x2*_0x5c291f&0x6)):0x0){_0x24d266=_0xa1b43f['indexOf'](_0x24d266);}for(let _0x3d5f23=0x0,_0xa19c34=_0x2a68ab['length'];_0x3d5f23<_0xa19c34;_0x3d5f23++){_0x296033+='%'+('00'+_0x2a68ab['charCodeAt'](_0x3d5f23)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x296033);};const _0x103869=function(_0x1a147f,_0x222e09){let _0x58e70f=[],_0x36c210=0x0,_0x2d7558,_0x255898='';_0x1a147f=_0x5c32eb(_0x1a147f);let _0x5182d4;for(_0x5182d4=0x0;_0x5182d4<0x100;_0x5182d4++){_0x58e70f[_0x5182d4]=_0x5182d4;}for(_0x5182d4=0x0;_0x5182d4<0x100;_0x5182d4++){_0x36c210=(_0x36c210+_0x58e70f[_0x5182d4]+_0x222e09['charCodeAt'](_0x5182d4%_0x222e09['length']))%0x100,_0x2d7558=_0x58e70f[_0x5182d4],_0x58e70f[_0x5182d4]=_0x58e70f[_0x36c210],_0x58e70f[_0x36c210]=_0x2d7558;}_0x5182d4=0x0,_0x36c210=0x0;for(let _0x150f3e=0x0;_0x150f3e<_0x1a147f['length'];_0x150f3e++){_0x5182d4=(_0x5182d4+0x1)%0x100,_0x36c210=(_0x36c210+_0x58e70f[_0x5182d4])%0x100,_0x2d7558=_0x58e70f[_0x5182d4],_0x58e70f[_0x5182d4]=_0x58e70f[_0x36c210],_0x58e70f[_0x36c210]=_0x2d7558,_0x255898+=String['fromCharCode'](_0x1a147f['charCodeAt'](_0x150f3e)^_0x58e70f[(_0x58e70f[_0x5182d4]+_0x58e70f[_0x36c210])%0x100]);}return _0x255898;};_0x1596['QcBJny']=_0x103869,_0x4c2357=arguments,_0x1596['uLPbqo']=!![];}const _0x23c400=_0x473631[0x0],_0xb216c=_0x159604+_0x23c400,_0x21dc8f=_0x4c2357[_0xb216c];return!_0x21dc8f?(_0x1596['KmTyqG']===undefined&&(_0x1596['KmTyqG']=!![]),_0x15fbc1=_0x1596['QcBJny'](_0x15fbc1,_0x3b24e1),_0x4c2357[_0xb216c]=_0x15fbc1):_0x15fbc1=_0x21dc8f,_0x15fbc1;},_0x1596(_0x4c2357,_0x1ff032);}function getCookie(){const _0xe46e71=_0x5d2700,_0x16f7e2={'aKMqS':function(_0x5b7245){return _0x5b7245();},'nujJL':function(_0x4d454b,_0x14c13a){return _0x4d454b!=_0x14c13a;},'yDnTJ':'OPTIONS','zFEsf':_0xe46e71(0x1a1,'sfKG'),'IYHwo':'User-Agent','kzdLc':_0xe46e71(0x190,'KAC)'),'yUkll':'appNo','FtSdX':function(_0x56a7ec,_0x28bbb4){return _0x56a7ec&&_0x28bbb4;},'eWDqO':_0xe46e71(0x154,'1vmJ'),'jNyEY':_0xe46e71(0x164,'%d28'),'iDZZy':_0xe46e71(0x178,'@SlD'),'uLKMp':_0xe46e71(0x17f,'dFJ('),'jJMoY':function(_0x24fc97,_0x25ef25){return _0x24fc97&&_0x25ef25;},'XmHDq':function(_0x1c4435,_0xe17bb0){return _0x1c4435!==_0xe17bb0;},'EzUxi':'iiEQJ','QUIpL':_0xe46e71(0x19c,'BDz]')};if($request&&$request['method']!=_0x16f7e2['yDnTJ']){const _0x2c73f4=$request[_0x16f7e2[_0xe46e71(0x15b,'2Cif')]][_0x16f7e2[_0xe46e71(0x160,'3J@O')]],_0x44abda=$request[_0xe46e71(0x17d,'ocDc')][_0x16f7e2[_0xe46e71(0x177,'efv1')]],_0x325241=$request[_0x16f7e2[_0xe46e71(0x1a0,'Z579')]][_0x16f7e2['uLKMp']],_0x2eb263=$request[_0x16f7e2['zFEsf']][_0x16f7e2['kzdLc']],_0x37f0d8=$request[_0x16f7e2[_0xe46e71(0x195,'BaUV')]][_0xe46e71(0x159,'%d28')];if(_0x16f7e2[_0xe46e71(0x194,'!Qzl')](_0x2c73f4,_0x44abda)&&_0x325241){if(_0x16f7e2[_0xe46e71(0x171,'lc9v')](_0x16f7e2[_0xe46e71(0x15d,'BDz]')],'iiEQJ')){_0x16f7e2[_0xe46e71(0x182,'2psO')](_0x57670f);return;}else $['setjson']({'token':_0x2c73f4,'UserAgent':_0x44abda,'Cookie':_0x325241,'channelNo':_0x2eb263,'appNo':_0x37f0d8},ckName),$['msg']($[_0xe46e71(0x16d,'1vmJ')],'',_0x16f7e2['eWDqO']);}else{if(_0x16f7e2[_0xe46e71(0x19e,'9RA$')]!==_0x16f7e2['QUIpL']){if(_0x11c51a&&_0x16f7e2['nujJL'](_0x223d4e['method'],_0x16f7e2[_0xe46e71(0x174,'q6eW')])){const _0x50df53=_0x44f07f[_0xe46e71(0x185,'z0wd')]['token'],_0xdff25=_0x1bda81[_0x16f7e2[_0xe46e71(0x168,'lc9v')]][_0x16f7e2['IYHwo']],_0x3c3423=_0x3f0e24[_0xe46e71(0x17b,'YXjE')]['Cookie'],_0x20ddff=_0x40bf2d[_0x16f7e2[_0xe46e71(0x166,'8eR!')]][_0x16f7e2[_0xe46e71(0x16b,'Gw6@')]],_0x3a8a69=_0x1717df[_0xe46e71(0x18b,'Nw8e')][_0x16f7e2['yUkll']];_0x16f7e2[_0xe46e71(0x180,'%d28')](_0x50df53,_0xdff25)&&_0x3c3423?(_0x1573b8[_0xe46e71(0x15a,'efv1')]({'token':_0x50df53,'UserAgent':_0xdff25,'Cookie':_0x3c3423,'channelNo':_0x20ddff,'appNo':_0x3a8a69},_0x41d626),_0x55af02[_0xe46e71(0x18e,'rm$V')](_0x5df91b[_0xe46e71(0x155,'FmzE')],'',_0x16f7e2[_0xe46e71(0x17c,'rm$V')])):_0x25e990[_0xe46e71(0x1a2,'dFJ(')](_0x214c46[_0xe46e71(0x15f,'an)V')],'',_0x16f7e2[_0xe46e71(0x188,'ImH&')]);}_0x38f54d[_0xe46e71(0x191,'FmzE')]();}else $[_0xe46e71(0x186,'2*vi')]($['name'],'',_0xe46e71(0x156,'ImH&'));}}$[_0xe46e71(0x176,'!Qzl')]();}async function couponAcquire(){const _0x3e8f64=_0x5d2700,_0x38c085={'lTAzH':function(_0x53b344){return _0x53b344();},'QOXoI':function(_0x182fad,_0x515ef4){return _0x182fad===_0x515ef4;}},_0x3c5882=_0x38c085['lTAzH'](headerData),_0x4c237c=_0x3e8f64(0x183,'q6eW'),_0x1dc609={'url':urlYSF,'headers':_0x3c5882,'body':_0x4c237c},_0x24f6df=await $[_0x3e8f64(0x187,'L*ON')][_0x3e8f64(0x197,'2*vi')](_0x1dc609);_0x38c085['QOXoI'](_0x24f6df[_0x3e8f64(0x157,'UMcJ')],0xc8)?$[_0x3e8f64(0x165,'^Tn!')]('✅\x20请求成功:\x20'+_0x24f6df[_0x3e8f64(0x158,']36u')]):$[_0x3e8f64(0x1a7,'gwh2')](_0x3e8f64(0x193,'L*ON')+_0x24f6df[_0x3e8f64(0x17a,'Z579')]+'\x0a'+_0x24f6df[_0x3e8f64(0x16e,'^Tn!')]);}(async()=>{const _0x1799d8=_0x5d2700,_0x4f4da9={'JjJnt':_0x1799d8(0x19b,'q6eW'),'DpsmH':function(_0x3d0ec1,_0x46fe10){return _0x3d0ec1(_0x46fe10);},'Mehif':function(_0x35cf26,_0x1d7db9){return _0x35cf26!==_0x1d7db9;},'uEgDO':function(_0x3d494d,_0x3ca63b,_0x2caee6){return _0x3d494d(_0x3ca63b,_0x2caee6);},'WZKRf':function(_0x3eda68,_0x10888d){return _0x3eda68!=_0x10888d;},'JfmCz':function(_0x1a5f2a){return _0x1a5f2a();}};if(_0x4f4da9['WZKRf'](typeof $request,_0x1799d8(0x175,'^Tn!'))){_0x4f4da9['JfmCz'](getCookie);return;}if(!userCookie){$[_0x1799d8(0x167,'UIYy')](_0x1799d8(0x1a5,'y0fY')),$['done']();return;}await new Promise(_0x5d08be=>{const _0x1afd94=_0x1799d8;if(_0x4f4da9[_0x1afd94(0x169,'L*ON')](_0x1afd94(0x18d,'Gw6@'),_0x1afd94(0x16f,'sUfl'))){let _0x442b03=0x0;const _0x11d3d4=0xa,_0x574c2f=0x64,_0x5ce2ad=_0x4f4da9[_0x1afd94(0x1a6,'rm$V')](setInterval,async()=>{const _0x401416=_0x1afd94,_0x2f7d98={'QpbVN':_0x4f4da9['JjJnt']};'JuycP'==='wAXls'?_0x4d6a4e['msg'](_0x4beb7a[_0x401416(0x189,'dFJ(')],'',_0x2f7d98['QpbVN']):(await couponAcquire(),_0x442b03++,_0x442b03>=_0x11d3d4&&(_0x4f4da9[_0x401416(0x181,'8eR!')](clearInterval,_0x5ce2ad),_0x5d08be()));},_0x574c2f);}else{_0x3146b[_0x1afd94(0x184,'q6eW')](_0x1afd94(0x19f,'Ea!&')),_0x170e69['done']();return;}});})()['finally'](()=>{const _0x129534=_0x5d2700;$[_0x129534(0x161,'gwh2')]();});var version_ = 'jsjiami.com.v7';



function Env(e,t){class s{constructor(e){this.env=e}send(e,t="GET"){e="string"==typeof e?{url:e}:e;let s=this.get;"POST"===t&&(s=this.post);const i=new Promise(((t,i)=>{s.call(this,e,((e,s,o)=>{e?i(e):t(s)}))}));return e.timeout?((e,t=1e3)=>Promise.race([e,new Promise(((e,s)=>{setTimeout((()=>{s(new Error("请求超时"))}),t)}))]))(i,e.timeout):i}get(e){return this.send.call(this.env,e)}post(e){return this.send.call(this.env,e,"POST")}}return new class{constructor(e,t){this.logLevels={debug:0,info:1,warn:2,error:3},this.logLevelPrefixs={debug:"[DEBUG] ",info:"[INFO] ",warn:"[WARN] ",error:"[ERROR] "},this.logLevel="info",this.name=e,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,t),this.log("",`🔔${this.name}, 开始!`)}getEnv(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":void 0}isNode(){return"Node.js"===this.getEnv()}isQuanX(){return"Quantumult X"===this.getEnv()}isSurge(){return"Surge"===this.getEnv()}isLoon(){return"Loon"===this.getEnv()}isShadowrocket(){return"Shadowrocket"===this.getEnv()}isStash(){return"Stash"===this.getEnv()}toObj(e,t=null){try{return JSON.parse(e)}catch{return t}}toStr(e,t=null,...s){try{return JSON.stringify(e,...s)}catch{return t}}getjson(e,t){let s=t;if(this.getdata(e))try{s=JSON.parse(this.getdata(e))}catch{}return s}setjson(e,t){try{return this.setdata(JSON.stringify(e),t)}catch{return!1}}getScript(e){return new Promise((t=>{this.get({url:e},((e,s,i)=>t(i)))}))}runScript(e,t){return new Promise((s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let o=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");o=o?1*o:20,o=t&&t.timeout?t.timeout:o;const[r,a]=i.split("@"),n={url:`http://${a}/v1/scripting/evaluate`,body:{script_text:e,mock_type:"cron",timeout:o},headers:{"X-Key":r,Accept:"*/*"},policy:"DIRECT",timeout:o};this.post(n,((e,t,i)=>s(i)))})).catch((e=>this.logErr(e)))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),i=!s&&this.fs.existsSync(t);if(!s&&!i)return{};{const i=s?e:t;try{return JSON.parse(this.fs.readFileSync(i))}catch(e){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),i=!s&&this.fs.existsSync(t),o=JSON.stringify(this.data);s?this.fs.writeFileSync(e,o):i?this.fs.writeFileSync(t,o):this.fs.writeFileSync(e,o)}}lodash_get(e,t,s){const i=t.replace(/\[(\d+)\]/g,".$1").split(".");let o=e;for(const e of i)if(o=Object(o)[e],void 0===o)return s;return o}lodash_set(e,t,s){return Object(e)!==e||(Array.isArray(t)||(t=t.toString().match(/[^.[\]]+/g)||[]),t.slice(0,-1).reduce(((e,s,i)=>Object(e[s])===e[s]?e[s]:e[s]=Math.abs(t[i+1])>>0==+t[i+1]?[]:{}),e)[t[t.length-1]]=s),e}getdata(e){let t=this.getval(e);if(/^@/.test(e)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(e),o=s?this.getval(s):"";if(o)try{const e=JSON.parse(o);t=e?this.lodash_get(e,i,""):t}catch(e){t=""}}return t}setdata(e,t){let s=!1;if(/^@/.test(t)){const[,i,o]=/^@(.*?)\.(.*?)$/.exec(t),r=this.getval(i),a=i?"null"===r?null:r||"{}":"{}";try{const t=JSON.parse(a);this.lodash_set(t,o,e),s=this.setval(JSON.stringify(t),i)}catch(t){const r={};this.lodash_set(r,o,e),s=this.setval(JSON.stringify(r),i)}}else s=this.setval(e,t);return s}getval(e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(e);case"Quantumult X":return $prefs.valueForKey(e);case"Node.js":return this.data=this.loaddata(),this.data[e];default:return this.data&&this.data[e]||null}}setval(e,t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(e,t);case"Quantumult X":return $prefs.setValueForKey(e,t);case"Node.js":return this.data=this.loaddata(),this.data[t]=e,this.writedata(),!0;default:return this.data&&this.data[t]||null}}initGotEnv(e){this.got=this.got?this.got:require("got").got,this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,e&&(e.headers=e.headers?e.headers:{},e&&(e.headers=e.headers?e.headers:{},void 0===e.headers.cookie&&void 0===e.headers.Cookie&&void 0===e.cookieJar&&(e.cookieJar=this.ckjar)))}get(e,t=(()=>{})){switch(e.headers&&(delete e.headers["Content-Type"],delete e.headers["Content-Length"],delete e.headers["content-type"],delete e.headers["content-length"]),e.params&&(e.url+="?"+this.queryStr(e.params)),void 0===e.followRedirect||e.followRedirect||((this.isSurge()||this.isLoon())&&(e["auto-redirect"]=!1),this.isQuanX()&&(e.opts?e.opts.redirection=!1:e.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(e,((e,s,i)=>{!e&&s&&(s.body=i,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),t(e,s,i)}));break;case"Quantumult X":this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then((e=>{const{statusCode:s,statusCode:i,headers:o,body:r,bodyBytes:a}=e;t(null,{status:s,statusCode:i,headers:o,body:r,bodyBytes:a},r,a)}),(e=>t(e&&e.error||"UndefinedError")));break;case"Node.js":let s=require("iconv-lite");this.initGotEnv(e),this.got(e).on("redirect",((e,t)=>{try{if(e.headers["set-cookie"]){const s=e.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),t.cookieJar=this.ckjar}}catch(e){this.logErr(e)}})).then((e=>{const{statusCode:i,statusCode:o,headers:r,rawBody:a}=e,n=s.decode(a,this.encoding);t(null,{status:i,statusCode:o,headers:r,rawBody:a,body:n},n)}),(e=>{const{message:i,response:o}=e;t(i,o,o&&s.decode(o.rawBody,this.encoding))}));break}}post(e,t=(()=>{})){const s=e.method?e.method.toLocaleLowerCase():"post";switch(e.body&&e.headers&&!e.headers["Content-Type"]&&!e.headers["content-type"]&&(e.headers["content-type"]="application/x-www-form-urlencoded"),e.headers&&(delete e.headers["Content-Length"],delete e.headers["content-length"]),void 0===e.followRedirect||e.followRedirect||((this.isSurge()||this.isLoon())&&(e["auto-redirect"]=!1),this.isQuanX()&&(e.opts?e.opts.redirection=!1:e.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient[s](e,((e,s,i)=>{!e&&s&&(s.body=i,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),t(e,s,i)}));break;case"Quantumult X":e.method=s,this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then((e=>{const{statusCode:s,statusCode:i,headers:o,body:r,bodyBytes:a}=e;t(null,{status:s,statusCode:i,headers:o,body:r,bodyBytes:a},r,a)}),(e=>t(e&&e.error||"UndefinedError")));break;case"Node.js":let i=require("iconv-lite");this.initGotEnv(e);const{url:o,...r}=e;this.got[s](o,r).then((e=>{const{statusCode:s,statusCode:o,headers:r,rawBody:a}=e,n=i.decode(a,this.encoding);t(null,{status:s,statusCode:o,headers:r,rawBody:a,body:n},n)}),(e=>{const{message:s,response:o}=e;t(s,o,o&&i.decode(o.rawBody,this.encoding))}));break}}time(e,t=null){const s=t?new Date(t):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let t in i)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?i[t]:("00"+i[t]).substr((""+i[t]).length)));return e}queryStr(e){let t="";for(const s in e){let i=e[s];null!=i&&""!==i&&("object"==typeof i&&(i=JSON.stringify(i)),t+=`${s}=${i}&`)}return t=t.substring(0,t.length-1),t}msg(t=e,s="",i="",o={}){const r=e=>{const{$open:t,$copy:s,$media:i,$mediaMime:o}=e;switch(typeof e){case void 0:return e;case"string":switch(this.getEnv()){case"Surge":case"Stash":default:return{url:e};case"Loon":case"Shadowrocket":return e;case"Quantumult X":return{"open-url":e};case"Node.js":return}case"object":switch(this.getEnv()){case"Surge":case"Stash":case"Shadowrocket":default:{const r={};let a=e.openUrl||e.url||e["open-url"]||t;a&&Object.assign(r,{action:"open-url",url:a});let n=e["update-pasteboard"]||e.updatePasteboard||s;n&&Object.assign(r,{action:"clipboard",text:n});let h=e.mediaUrl||e["media-url"]||i;if(h){let e,t;if(h.startsWith("http"));else if(h.startsWith("data:")){const[s]=h.split(";"),[,i]=h.split(",");e=i,t=s.replace("data:","")}else{e=h,t=(e=>{const t={JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"};for(var s in t)if(0===e.indexOf(s))return t[s];return null})(h)}Object.assign(r,{"media-url":h,"media-base64":e,"media-base64-mime":o??t})}return Object.assign(r,{"auto-dismiss":e["auto-dismiss"],sound:e.sound}),r}case"Loon":{const s={};let o=e.openUrl||e.url||e["open-url"]||t;o&&Object.assign(s,{openUrl:o});let r=e.mediaUrl||e["media-url"]||i;return r&&Object.assign(s,{mediaUrl:r}),console.log(JSON.stringify(s)),s}case"Quantumult X":{const o={};let r=e["open-url"]||e.url||e.openUrl||t;r&&Object.assign(o,{"open-url":r});let a=e.mediaUrl||e["media-url"]||i;a&&Object.assign(o,{"media-url":a});let n=e["update-pasteboard"]||e.updatePasteboard||s;return n&&Object.assign(o,{"update-pasteboard":n}),console.log(JSON.stringify(o)),o}case"Node.js":return}default:return}};if(!this.isMute)switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(t,s,i,r(o));break;case"Quantumult X":$notify(t,s,i,r(o));break;case"Node.js":break}if(!this.isMuteLog){let e=["","==============📣系统通知📣=============="];e.push(t),s&&e.push(s),i&&e.push(i),console.log(e.join("\n")),this.logs=this.logs.concat(e)}}debug(...e){this.logLevels[this.logLevel]<=this.logLevels.debug&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.debug}${e.map((e=>e??String(e))).join(this.logSeparator)}`))}info(...e){this.logLevels[this.logLevel]<=this.logLevels.info&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.info}${e.map((e=>e??String(e))).join(this.logSeparator)}`))}warn(...e){this.logLevels[this.logLevel]<=this.logLevels.warn&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.warn}${e.map((e=>e??String(e))).join(this.logSeparator)}`))}error(...e){this.logLevels[this.logLevel]<=this.logLevels.error&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.error}${e.map((e=>e??String(e))).join(this.logSeparator)}`))}log(...e){e.length>0&&(this.logs=[...this.logs,...e]),console.log(e.map((e=>e??String(e))).join(this.logSeparator))}logErr(e,t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:this.log("",`❗️${this.name}, 错误!`,t,e);break;case"Node.js":this.log("",`❗️${this.name}, 错误!`,t,void 0!==e.message?e.message:e,e.stack);break}}wait(e){return new Promise((t=>setTimeout(t,e)))}done(e={}){const t=((new Date).getTime()-this.startTime)/1e3;switch(this.log("",`🔔${this.name}, 结束! 🕛 ${t} 秒`),this.log(),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:$done(e);break;case"Node.js":process.exit(1)}}}(e,t)}