/**
Title: Longfor 国补
Nomination / Category: Surge、QuantumultX、Loon、Shadowrocket、Node.js
Written by: lslive
Date: 2025-7-31
Draft Version: 0.1
Contact Info: https://github.com/lslive
Notes: 只测试过圈X，其它环境请自行尝试 电视卷，未开发其他卷包
*/


var _0xodF='jsjiami.com.v7';const _0x4c34b0=_0x33a0;(function(_0x5f3bcb,_0x1d7e17,_0x306c15,_0x14c8c8,_0x5bf30c,_0x4e4815,_0x5e127c){return _0x5f3bcb=_0x5f3bcb>>0x5,_0x4e4815='hs',_0x5e127c='hs',function(_0x3c8fc6,_0x374c4e,_0xd4977f,_0x258c77,_0x196c1f){const _0x1f9d4b=_0x33a0;_0x258c77='tfi',_0x4e4815=_0x258c77+_0x4e4815,_0x196c1f='up',_0x5e127c+=_0x196c1f,_0x4e4815=_0xd4977f(_0x4e4815),_0x5e127c=_0xd4977f(_0x5e127c),_0xd4977f=0x0;const _0xc053b9=_0x3c8fc6();while(!![]&&--_0x14c8c8+_0x374c4e){try{_0x258c77=parseInt(_0x1f9d4b(0xb6,'5D@c'))/0x1*(-parseInt(_0x1f9d4b(0xa1,'4Hf@'))/0x2)+-parseInt(_0x1f9d4b(0x8f,'KKl4'))/0x3+parseInt(_0x1f9d4b(0x6d,'8!qx'))/0x4+parseInt(_0x1f9d4b(0x97,'XBIC'))/0x5*(parseInt(_0x1f9d4b(0x7d,'O6dS'))/0x6)+parseInt(_0x1f9d4b(0xd1,'og%v'))/0x7+parseInt(_0x1f9d4b(0x85,'k()O'))/0x8+-parseInt(_0x1f9d4b(0x74,'51AL'))/0x9*(parseInt(_0x1f9d4b(0x98,'4V$z'))/0xa);}catch(_0x526277){_0x258c77=_0xd4977f;}finally{_0x196c1f=_0xc053b9[_0x4e4815]();if(_0x5f3bcb<=_0x14c8c8)_0xd4977f?_0x5bf30c?_0x258c77=_0x196c1f:_0x5bf30c=_0x196c1f:_0xd4977f=_0x196c1f;else{if(_0xd4977f==_0x5bf30c['replace'](/[ATfVgyYCIxJdtUHXeuLW=]/g,'')){if(_0x258c77===_0x374c4e){_0xc053b9['un'+_0x4e4815](_0x196c1f);break;}_0xc053b9[_0x5e127c](_0x196c1f);}}}}}(_0x306c15,_0x1d7e17,function(_0x5eac78,_0x50ba14,_0x54c627,_0x11e5d4,_0x59b1ef,_0x169b72,_0x1897f7){return _0x50ba14='\x73\x70\x6c\x69\x74',_0x5eac78=arguments[0x0],_0x5eac78=_0x5eac78[_0x50ba14](''),_0x54c627='\x72\x65\x76\x65\x72\x73\x65',_0x5eac78=_0x5eac78[_0x54c627]('\x76'),_0x11e5d4='\x6a\x6f\x69\x6e',(0x1b9c8a,_0x5eac78[_0x11e5d4](''));});}(0x17c0,0xc6a60,_0x170b,0xc0),_0x170b)&&(_0xodF=_0x4c34b0(0xdf,'XBIC'));const $=new Env(_0x4c34b0(0xca,'#K2*')),ckName=_0x4c34b0(0x7b,'UXyt');function _0x170b(){const _0x1e3a9a=(function(){return[_0xodF,'CJVjufsYjdAiaygmtiu.UCfcToIHXmtL.Wve7Uyx==','WONdIqzqW6i','xSkZW5vmWQC','sCk/W7C','WRtdJsr7W6O','FCknW5y','W6hcKSkXWQafWRO','WPtdJSkmWPKMWO9vpG','WPDOEgacWO3dLCkOn8kBy3ldVa','ntPLDmo7','qL1CW7meW7K','W4ZcNmkZWQ4','WRNcTSoCiG','6i6Y5y2j56Y05yQrWQldKW7cUbNdOEAjH+wjSVcyVjC','W7i4BZZdVtuJbmoz','W7TgWQRcICoOgmoF','nCo7WQtdSsKSWQ8WW640W58','WPzAEwGmW7mEW5XhWRRcLCoFomoIWOVcLwi9DmkntGBdNujwqSoXcahcLxRcJ8k/yue9BI4BWQTRjGfNWOS6nCkLW7lcLN3dQCotDLu','WP7cMGXLnSkRWQC','WQpdRgpdUG','WOiqfCkjW5u','WOauzmkMW50','W5uxFW','BGGz','WQuwEmofWP/dJ8oOW6pcVSkWWRDwWRpcJW','W4bJWOOLva','dmobWPZdIfK','lhhcOZ7cUW','j8oHWO/dJKq','WPXjWQT5da','nCkbcd8','zmkHW7ZcP3eJWRO7W7K','WOuynCkzpq','WRNcQ8kZWQKP','W5qZWQWzCea8WQLTWPHxWP9l','E8kxpKK','uLpdKCkzWRJdVCoapSoDxwldH0ZdHbj/','WO4cFZrV','BLLSemk8eSoh','WQ7cPSoBieJdM8kK','WO7cQSkr','WPtdSgldSCoCgmoTrSkF'].concat((function(){return['AsBdSw7cHNSuW48sW6G','tmk1W7xcOZNcMCoMDmoed0reBa','WQpcGmoUWRtcNW','bdtcKCkGrq','WOdcRSkWhCkT','DmkvW450WRpcKmoRWQBdGCkNWPFcNmkJqt7dH8kbB8olWOKZkCkMWQCIW5SQjCkEWRiqW79NwWGDoqZcUH3cPqRcJhNcSrRdKIT1W5fJW6SRCXFdL8ovu8kwW5VcSXVcGd5Sb8kTWRZdT8oFW6nMvmk4WRm/WQ8TW6/cU0yOeW','hXbyFa','cCofWRddSq','WROMjSkhy8kAWQnHW5uJ','uCoBkCojWQ4','WOtcH1DYWONdSSo6W5hcGWnan2y','B8keW45UWRpdHCkQ','W67dHbqjW5C','BCo6k8ofWOtdJHi','W6eUE2VdUq','W5TGWOdcU8oc','4PQp77I3coITRoAWQEwMRoI0N3i/','WOvlWRzXca','WOBdO1dcPYNcTSojWRa','gs7dVgVdPW','W5uxDq','WP8GmmkD','WO4sr8kfW4i','jCkguxJdSWhcTZq0W4RcUrWXFG','l8oLW5ddIq','mmoMqfHd','p8oLW5xdICkN','FYiOiCkwhSoCks3dOG','o8o/W43dHa','dthcP8kBvG','qJqSn8oElCoi','lSo2W7eWW7lcLGa','WRzCWO9zWOm','WPddLqO','sahdGmkhWRtdV8oIjCoqvY7dKGtcGuWHW7vgW7ldJCkohmoph8kvuSoWW4VcJIHKjvziW43cI1fIp8osWQLWW5nEe2lcOuv9hmoCW4pdVhlcOqtcJ04MW6mXWPZdLqZcISoZW7bAW7OCW7xcSmksamoDW4/cICogxZrHcmkPW6bEW7pdR8ktfvtdImk9t8kRW69Pyr9ZWOFdU8kzgeKoW7axemk5lvxdO2C','WOJdSSkE','q8oebHZcIq','W71BWPqQwHhdL0xcVa','W5SEwNK','WOZcP8k/WQGJ','4PYqW5BORQtMSA7MIz/LIkTpAG','r8obW4GiW5K','ASk6W7O'].concat((function(){return['W4JcT23cTW8','WPpdHCoNW74/WPzJhmkdla','W5yVmJe','gCkLja','W7HaWOmN','W6DQDa','6iY/5y+J566o5yM/FXFdLKVcSCod5OIQ5yIQ8lg+Sa','bCopWR/dSfNcI1G','5lQY6zAE5lQ4W4ZLMzNOOPi','rSo7hSoSWOO','4P+U6kYk5yAw6i285y66W79gja','WRtdTmoXW7q','FCkrW4PkWQ8','AZCRWRRdQW','W4xcJSkOWQ84','fWazWQLCWQqnaLJcNaZdI1G','lbVcNCkmvW','g8k7W7WfWRfvW4ZdMSoiv8kjrCk7','EmoGWRiJ','WRTQA30M','W4iQw3BdGG','or/cOmkfyG','WQj3WOdcMmoRimop','qvLfW74','yWqEo8oE','WOddL3tdS8oX','d8oMW6FdTmkb','W6bxWQRcMCo4gCoVnCkOW5e','z0X9oSk2','mM3cOJlcTf8BWPi0W643wmoNWQm','BmkuW4LS','Db0hWRBdKq','wMtdSCkWWPm','WQHJgMuo','v8oycYtcQvy','W5JdLaKJ','yKvs','WOesea','WR0BfCoyW5S','W48AnsTnW7LhWPbEWRxcHmoC'];}()));}()));}());_0x170b=function(){return _0x1e3a9a;};return _0x170b();};function _0x33a0(_0xfdf88c,_0x1c5889){const _0x170b96=_0x170b();return _0x33a0=function(_0x33a06b,_0x581595){_0x33a06b=_0x33a06b-0x6b;let _0x56dcf1=_0x170b96[_0x33a06b];if(_0x33a0['tnvJvC']===undefined){var _0x233f19=function(_0x1586aa){const _0x52894a='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4a30c4='',_0x466ac7='';for(let _0x225997=0x0,_0x97d830,_0x284c06,_0x44c450=0x0;_0x284c06=_0x1586aa['charAt'](_0x44c450++);~_0x284c06&&(_0x97d830=_0x225997%0x4?_0x97d830*0x40+_0x284c06:_0x284c06,_0x225997++%0x4)?_0x4a30c4+=String['fromCharCode'](0xff&_0x97d830>>(-0x2*_0x225997&0x6)):0x0){_0x284c06=_0x52894a['indexOf'](_0x284c06);}for(let _0x6e3ce8=0x0,_0x2a1963=_0x4a30c4['length'];_0x6e3ce8<_0x2a1963;_0x6e3ce8++){_0x466ac7+='%'+('00'+_0x4a30c4['charCodeAt'](_0x6e3ce8)['toString'](0x10))['slice'](-0x2);}return decodeURIComponent(_0x466ac7);};const _0x12423d=function(_0x416bbc,_0xea2cb0){let _0x49ef4c=[],_0x5ca322=0x0,_0x2b7c0b,_0x229b5f='';_0x416bbc=_0x233f19(_0x416bbc);let _0x2be589;for(_0x2be589=0x0;_0x2be589<0x100;_0x2be589++){_0x49ef4c[_0x2be589]=_0x2be589;}for(_0x2be589=0x0;_0x2be589<0x100;_0x2be589++){_0x5ca322=(_0x5ca322+_0x49ef4c[_0x2be589]+_0xea2cb0['charCodeAt'](_0x2be589%_0xea2cb0['length']))%0x100,_0x2b7c0b=_0x49ef4c[_0x2be589],_0x49ef4c[_0x2be589]=_0x49ef4c[_0x5ca322],_0x49ef4c[_0x5ca322]=_0x2b7c0b;}_0x2be589=0x0,_0x5ca322=0x0;for(let _0x4c7d29=0x0;_0x4c7d29<_0x416bbc['length'];_0x4c7d29++){_0x2be589=(_0x2be589+0x1)%0x100,_0x5ca322=(_0x5ca322+_0x49ef4c[_0x2be589])%0x100,_0x2b7c0b=_0x49ef4c[_0x2be589],_0x49ef4c[_0x2be589]=_0x49ef4c[_0x5ca322],_0x49ef4c[_0x5ca322]=_0x2b7c0b,_0x229b5f+=String['fromCharCode'](_0x416bbc['charCodeAt'](_0x4c7d29)^_0x49ef4c[(_0x49ef4c[_0x2be589]+_0x49ef4c[_0x5ca322])%0x100]);}return _0x229b5f;};_0x33a0['uPQFQf']=_0x12423d,_0xfdf88c=arguments,_0x33a0['tnvJvC']=!![];}const _0x170ece=_0x170b96[0x0],_0x4c698a=_0x33a06b+_0x170ece,_0x4e39a4=_0xfdf88c[_0x4c698a];return!_0x4e39a4?(_0x33a0['mbUXdA']===undefined&&(_0x33a0['mbUXdA']=!![]),_0x56dcf1=_0x33a0['uPQFQf'](_0x56dcf1,_0x581595),_0xfdf88c[_0x4c698a]=_0x56dcf1):_0x56dcf1=_0x4e39a4,_0x56dcf1;},_0x33a0(_0xfdf88c,_0x1c5889);}let userCookie=$[_0x4c34b0(0x94,'(sk]')](ckName);const urlYSF=_0x4c34b0(0x7e,'8!qx');function headerData(){const _0x2d84a2=_0x4c34b0,_0x3e5bf8={'CdTMk':_0x2d84a2(0x96,'LSL4'),'xrmFk':_0x2d84a2(0x88,'XBIC'),'pHjdS':_0x2d84a2(0xe4,'vvgO'),'JuoJw':_0x2d84a2(0xde,'qAC5')};return{'Content-Type':_0x2d84a2(0x91,'A%h1'),'User-Agent':userCookie[_0x3e5bf8[_0x2d84a2(0xcb,'juY#')]],'channelNo':userCookie[_0x2d84a2(0x8c,'O6dS')],'token':userCookie[_0x3e5bf8[_0x2d84a2(0xa8,'Ndvs')]],'Cookie':userCookie[_0x3e5bf8[_0x2d84a2(0xbe,'Ibln')]],'Referer':_0x2d84a2(0x9c,'f17%'),'appNo':userCookie[_0x3e5bf8['JuoJw']]};}function getCookie(){const _0x745daa=_0x4c34b0,_0x41fc24={'Pfbnh':function(_0x28697e,_0x5ede27){return _0x28697e!=_0x5ede27;},'HEYqB':_0x745daa(0x7f,'Lm44'),'XqpOl':_0x745daa(0x6e,'aROX'),'WsbSI':_0x745daa(0xb2,'So]y'),'WigZu':_0x745daa(0x93,'qAC5'),'JCtkI':_0x745daa(0x7a,'juY#')};if($request&&_0x41fc24[_0x745daa(0x6c,'%3[8')]($request[_0x745daa(0x77,'og%v')],_0x41fc24[_0x745daa(0x76,'k)E!')])){const _0x5e111f=$request[_0x745daa(0x7c,'jDs)')][_0x41fc24[_0x745daa(0xa3,'4Hf@')]],_0x50ca99=$request[_0x745daa(0xc9,'[6&]')][_0x41fc24[_0x745daa(0xbb,'vvgO')]],_0x3ea847=$request[_0x41fc24['WigZu']][_0x745daa(0x73,'51AL')],_0x486355=$request['headers']['channelNo'],_0x6ea397=$request[_0x41fc24[_0x745daa(0xe1,'#K2*')]][_0x745daa(0xce,'f17%')];_0x5e111f&&_0x50ca99&&_0x3ea847?($[_0x745daa(0xa2,'f17%')]({'token':_0x5e111f,'UserAgent':_0x50ca99,'Cookie':_0x3ea847,'channelNo':_0x486355,'appNo':_0x6ea397},ckName),$['msg']($[_0x745daa(0x78,'51AL')],'',_0x41fc24[_0x745daa(0xad,'$1Wc')])):$[_0x745daa(0xc1,'O6dS')]($[_0x745daa(0xe5,'4Hf@')],'','错误获取签到Cookie失败');}$[_0x745daa(0x9e,'[6&]')]();}async function couponAcquire(_0x4bedf8){const _0x63e62=_0x4c34b0,_0x21a4fa={'HCKVO':_0x63e62(0xb5,'So]y'),'iArgx':'Cookie','gMrqm':'channelNo','HVzjh':_0x63e62(0x8a,'Ndvs'),'BRoHg':function(_0x4e23f9,_0x375a3a){return _0x4e23f9&&_0x375a3a;},'pKPsy':_0x63e62(0xc8,'YWOe'),'IlMZd':'错误获取签到Cookie失败','npKwQ':function(_0x73686d,_0x58ceb9){return _0x73686d===_0x58ceb9;},'ScuoY':function(_0x42b07f,_0x5140d9){return _0x42b07f===_0x5140d9;},'gsvdT':_0x63e62(0x9a,'J@S2')},_0x41290c=headerData(),_0x4df3b1=_0x63e62(0xb9,'A%h1')+_0x4bedf8+'\x22,\x22activityId\x22:null,\x22engGrade\x22:null,\x22coordType\x22:\x22gcj02ll\x22,\x22gpsAreaCode\x22:\x22610113\x22}',_0xfff121={'url':urlYSF,'headers':_0x41290c,'body':_0x4df3b1},_0x531640=await $[_0x63e62(0xcd,'Mfx&')][_0x63e62(0xd4,'uhv4')](_0xfff121);if(_0x21a4fa[_0x63e62(0xb7,'C6%7')](_0x531640['statusCode'],0xc8))$['log'](_0x63e62(0xbf,'iNYo')+_0x531640[_0x63e62(0x80,'LSL4')]);else{if(_0x21a4fa[_0x63e62(0xb4,'J@S2')](_0x21a4fa[_0x63e62(0xd0,'51AL')],_0x63e62(0x89,'4V$z')))$[_0x63e62(0x6b,'%3[8')](_0x63e62(0xa7,'og%v')+_0x531640[_0x63e62(0xdd,'jDs)')]+'\x0a'+_0x531640[_0x63e62(0x9d,'k)E!')]);else{const _0x3ea6e7=_0x34d557[_0x21a4fa['HCKVO']][_0x63e62(0xb1,'ctB4')],_0x56f786=_0x26da91[_0x21a4fa['HCKVO']][_0x63e62(0x9f,'JRfB')],_0x50e826=_0x4ea2e7[_0x21a4fa[_0x63e62(0xa6,'jDs)')]][_0x21a4fa[_0x63e62(0xd6,'UXyt')]],_0xd6b6b0=_0x3ae0ef[_0x63e62(0xa4,'juY#')][_0x21a4fa[_0x63e62(0xd7,'J@S2')]],_0x41043e=_0xc940c8[_0x21a4fa[_0x63e62(0xcf,'#K2*')]][_0x21a4fa[_0x63e62(0x86,'YWOe')]];_0x21a4fa[_0x63e62(0x6f,'f17%')](_0x3ea6e7,_0x56f786)&&_0x50e826?(_0x161e79['setjson']({'token':_0x3ea6e7,'UserAgent':_0x56f786,'Cookie':_0x50e826,'channelNo':_0xd6b6b0,'appNo':_0x41043e},_0x3241a1),_0x439598[_0x63e62(0xb8,'aROX')](_0x3d5f14[_0x63e62(0xd9,'og%v')],'',_0x21a4fa['pKPsy'])):_0x4846dc['msg'](_0x140b1c[_0x63e62(0x90,'iNYo')],'',_0x21a4fa['IlMZd']);}}}(async()=>{const _0x43bc82=_0x4c34b0,_0x5f4011={'jMvls':function(_0x434e23,_0x4dcb5c){return _0x434e23!=_0x4dcb5c;},'LxwEW':_0x43bc82(0xbc,'YWOe'),'jEogo':function(_0x24d364,_0x533abb){return _0x24d364!==_0x533abb;},'EDfeY':_0x43bc82(0x71,'aROX'),'pkVeE':function(_0x44ea5f,_0x2a65e0){return _0x44ea5f(_0x2a65e0);},'DlYXH':_0x43bc82(0x84,'og%v'),'xgoBl':function(_0x214549,_0x5026cd){return _0x214549(_0x5026cd);},'gQQaR':_0x43bc82(0x83,'k()O'),'hsWPv':_0x43bc82(0xc5,'l6FQ'),'WpTRg':function(_0xe4b2fe,_0x410e1f){return _0xe4b2fe(_0x410e1f);},'ATspl':'A0401','IUShe':function(_0x201a36,_0x2cdf73){return _0x201a36(_0x2cdf73);},'knAoi':_0x43bc82(0xe3,'lZt4'),'XcrMM':function(_0x3e4233,_0x5437e4){return _0x3e4233(_0x5437e4);},'bkFEn':_0x43bc82(0xaa,'XBIC'),'UEnut':function(_0x5f1f27,_0x1e7a21){return _0x5f1f27(_0x1e7a21);},'rIOxX':_0x43bc82(0x70,'uhv4'),'LOteg':function(_0x25dfa1,_0x42c07f){return _0x25dfa1(_0x42c07f);},'qFPRW':'A07','ylsPn':_0x43bc82(0xab,'k()O'),'tBsuS':'A10','iGPEB':function(_0x22bb30,_0x979fdb){return _0x22bb30(_0x979fdb);},'DEWHV':_0x43bc82(0xba,'(sk]'),'TDchO':_0x43bc82(0xe6,'#K2*')};if(_0x5f4011[_0x43bc82(0x8d,'JRfB')](typeof $request,_0x5f4011['LxwEW'])){if(_0x5f4011['jEogo'](_0x5f4011[_0x43bc82(0x8e,'Ibln')],_0x5f4011[_0x43bc82(0xd5,'8!qx')]))_0xba3e45[_0x43bc82(0xaf,'ctB4')]();else{getCookie();return;}}if(!userCookie){$[_0x43bc82(0x95,'v$i6')](_0x43bc82(0xcc,'51AL')),$['done']();return;}const _0x407a05=[];for(let _0x3ea8c5=0x0;_0x3ea8c5<0xa;_0x3ea8c5++){_0x407a05[_0x43bc82(0xac,'JRfB')](_0x5f4011[_0x43bc82(0x99,'j8i#')](couponAcquire,_0x5f4011[_0x43bc82(0xdc,'ctB4')])),_0x407a05[_0x43bc82(0xbd,'UXyt')](_0x5f4011[_0x43bc82(0xc2,'mJ5]')](couponAcquire,_0x5f4011[_0x43bc82(0x92,'lZt4')])),_0x407a05[_0x43bc82(0xb3,'ctB4')](couponAcquire(_0x5f4011[_0x43bc82(0xb0,'l6FQ')])),_0x407a05[_0x43bc82(0x79,'(sk]')](_0x5f4011['WpTRg'](couponAcquire,_0x5f4011[_0x43bc82(0xdb,'LSL4')])),_0x407a05['push'](_0x5f4011[_0x43bc82(0xda,'So]y')](couponAcquire,_0x5f4011['knAoi'])),_0x407a05[_0x43bc82(0xc6,'YWOe')](_0x5f4011[_0x43bc82(0xc0,'5D@c')](couponAcquire,_0x5f4011[_0x43bc82(0x9b,'v$i6')])),_0x407a05[_0x43bc82(0x8b,'YeJ@')](couponAcquire(_0x43bc82(0xc7,'9hQc'))),_0x407a05['push'](_0x5f4011['UEnut'](couponAcquire,_0x5f4011[_0x43bc82(0xd2,'J@S2')])),_0x407a05['push'](_0x5f4011[_0x43bc82(0x81,'x$g4')](couponAcquire,_0x5f4011[_0x43bc82(0x87,'4V$z')])),_0x407a05['push'](couponAcquire(_0x5f4011['ylsPn'])),_0x407a05['push'](_0x5f4011['LOteg'](couponAcquire,'A09')),_0x407a05['push'](couponAcquire(_0x5f4011['tBsuS'])),_0x407a05[_0x43bc82(0xc4,'9hQc')](_0x5f4011[_0x43bc82(0xe2,'A%h1')](couponAcquire,_0x5f4011[_0x43bc82(0x82,'$1Wc')])),_0x407a05[_0x43bc82(0xe0,'f17%')](_0x5f4011[_0x43bc82(0xa5,'nv$U')](couponAcquire,_0x5f4011[_0x43bc82(0xa0,'juY#')]));}await Promise[_0x43bc82(0x72,'f17%')](_0x407a05);})()['finally'](()=>{$['done']();});var version_ = 'jsjiami.com.v7';


function Env(e,t){class s{constructor(e){this.env=e}send(e,t="GET"){e="string"==typeof e?{url:e}:e;let s=this.get;"POST"===t&&(s=this.post);const i=new Promise(((t,i)=>{s.call(this,e,((e,s,o)=>{e?i(e):t(s)}))}));return e.timeout?((e,t=1e3)=>Promise.race([e,new Promise(((e,s)=>{setTimeout((()=>{s(new Error("请求超时"))}),t)}))]))(i,e.timeout):i}get(e){return this.send.call(this.env,e)}post(e){return this.send.call(this.env,e,"POST")}}return new class{constructor(e,t){this.logLevels={debug:0,info:1,warn:2,error:3},this.logLevelPrefixs={debug:"[DEBUG] ",info:"[INFO] ",warn:"[WARN] ",error:"[ERROR] "},this.logLevel="info",this.name=e,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.encoding="utf-8",this.startTime=(new Date).getTime(),Object.assign(this,t),this.log("",`🔔${this.name}, 开始!`)}getEnv(){return"undefined"!=typeof $environment&&$environment["surge-version"]?"Surge":"undefined"!=typeof $environment&&$environment["stash-version"]?"Stash":"undefined"!=typeof module&&module.exports?"Node.js":"undefined"!=typeof $task?"Quantumult X":"undefined"!=typeof $loon?"Loon":"undefined"!=typeof $rocket?"Shadowrocket":void 0}isNode(){return"Node.js"===this.getEnv()}isQuanX(){return"Quantumult X"===this.getEnv()}isSurge(){return"Surge"===this.getEnv()}isLoon(){return"Loon"===this.getEnv()}isShadowrocket(){return"Shadowrocket"===this.getEnv()}isStash(){return"Stash"===this.getEnv()}toObj(e,t=null){try{return JSON.parse(e)}catch{return t}}toStr(e,t=null,...s){try{return JSON.stringify(e,...s)}catch{return t}}getjson(e,t){let s=t;if(this.getdata(e))try{s=JSON.parse(this.getdata(e))}catch{}return s}setjson(e,t){try{return this.setdata(JSON.stringify(e),t)}catch{return!1}}getScript(e){return new Promise((t=>{this.get({url:e},((e,s,i)=>t(i)))}))}runScript(e,t){return new Promise((s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let o=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");o=o?1*o:20,o=t&&t.timeout?t.timeout:o;const[r,a]=i.split("@"),n={url:`http://${a}/v1/scripting/evaluate`,body:{script_text:e,mock_type:"cron",timeout:o},headers:{"X-Key":r,Accept:"*/*"},policy:"DIRECT",timeout:o};this.post(n,((e,t,i)=>s(i)))})).catch((e=>this.logErr(e)))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),i=!s&&this.fs.existsSync(t);if(!s&&!i)return{};{const i=s?e:t;try{return JSON.parse(this.fs.readFileSync(i))}catch(e){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),i=!s&&this.fs.existsSync(t),o=JSON.stringify(this.data);s?this.fs.writeFileSync(e,o):i?this.fs.writeFileSync(t,o):this.fs.writeFileSync(e,o)}}lodash_get(e,t,s){const i=t.replace(/\[(\d+)\]/g,".$1").split(".");let o=e;for(const e of i)if(o=Object(o)[e],void 0===o)return s;return o}lodash_set(e,t,s){return Object(e)!==e||(Array.isArray(t)||(t=t.toString().match(/[^.[\]]+/g)||[]),t.slice(0,-1).reduce(((e,s,i)=>Object(e[s])===e[s]?e[s]:e[s]=Math.abs(t[i+1])>>0==+t[i+1]?[]:{}),e)[t[t.length-1]]=s),e}getdata(e){let t=this.getval(e);if(/^@/.test(e)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(e),o=s?this.getval(s):"";if(o)try{const e=JSON.parse(o);t=e?this.lodash_get(e,i,""):t}catch(e){t=""}}return t}setdata(e,t){let s=!1;if(/^@/.test(t)){const[,i,o]=/^@(.*?)\.(.*?)$/.exec(t),r=this.getval(i),a=i?"null"===r?null:r||"{}":"{}";try{const t=JSON.parse(a);this.lodash_set(t,o,e),s=this.setval(JSON.stringify(t),i)}catch(t){const r={};this.lodash_set(r,o,e),s=this.setval(JSON.stringify(r),i)}}else s=this.setval(e,t);return s}getval(e){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.read(e);case"Quantumult X":return $prefs.valueForKey(e);case"Node.js":return this.data=this.loaddata(),this.data[e];default:return this.data&&this.data[e]||null}}setval(e,t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":return $persistentStore.write(e,t);case"Quantumult X":return $prefs.setValueForKey(e,t);case"Node.js":return this.data=this.loaddata(),this.data[t]=e,this.writedata(),!0;default:return this.data&&this.data[t]||null}}initGotEnv(e){this.got=this.got?this.got:require("got").got,this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,e&&(e.headers=e.headers?e.headers:{},e&&(e.headers=e.headers?e.headers:{},void 0===e.headers.cookie&&void 0===e.headers.Cookie&&void 0===e.cookieJar&&(e.cookieJar=this.ckjar)))}get(e,t=(()=>{})){switch(e.headers&&(delete e.headers["Content-Type"],delete e.headers["Content-Length"],delete e.headers["content-type"],delete e.headers["content-length"]),e.params&&(e.url+="?"+this.queryStr(e.params)),void 0===e.followRedirect||e.followRedirect||((this.isSurge()||this.isLoon())&&(e["auto-redirect"]=!1),this.isQuanX()&&(e.opts?e.opts.redirection=!1:e.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(e,((e,s,i)=>{!e&&s&&(s.body=i,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),t(e,s,i)}));break;case"Quantumult X":this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then((e=>{const{statusCode:s,statusCode:i,headers:o,body:r,bodyBytes:a}=e;t(null,{status:s,statusCode:i,headers:o,body:r,bodyBytes:a},r,a)}),(e=>t(e&&e.error||"UndefinedError")));break;case"Node.js":let s=require("iconv-lite");this.initGotEnv(e),this.got(e).on("redirect",((e,t)=>{try{if(e.headers["set-cookie"]){const s=e.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),t.cookieJar=this.ckjar}}catch(e){this.logErr(e)}})).then((e=>{const{statusCode:i,statusCode:o,headers:r,rawBody:a}=e,n=s.decode(a,this.encoding);t(null,{status:i,statusCode:o,headers:r,rawBody:a,body:n},n)}),(e=>{const{message:i,response:o}=e;t(i,o,o&&s.decode(o.rawBody,this.encoding))}));break}}post(e,t=(()=>{})){const s=e.method?e.method.toLocaleLowerCase():"post";switch(e.body&&e.headers&&!e.headers["Content-Type"]&&!e.headers["content-type"]&&(e.headers["content-type"]="application/x-www-form-urlencoded"),e.headers&&(delete e.headers["Content-Length"],delete e.headers["content-length"]),void 0===e.followRedirect||e.followRedirect||((this.isSurge()||this.isLoon())&&(e["auto-redirect"]=!1),this.isQuanX()&&(e.opts?e.opts.redirection=!1:e.opts={redirection:!1})),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient[s](e,((e,s,i)=>{!e&&s&&(s.body=i,s.statusCode=s.status?s.status:s.statusCode,s.status=s.statusCode),t(e,s,i)}));break;case"Quantumult X":e.method=s,this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then((e=>{const{statusCode:s,statusCode:i,headers:o,body:r,bodyBytes:a}=e;t(null,{status:s,statusCode:i,headers:o,body:r,bodyBytes:a},r,a)}),(e=>t(e&&e.error||"UndefinedError")));break;case"Node.js":let i=require("iconv-lite");this.initGotEnv(e);const{url:o,...r}=e;this.got[s](o,r).then((e=>{const{statusCode:s,statusCode:o,headers:r,rawBody:a}=e,n=i.decode(a,this.encoding);t(null,{status:s,statusCode:o,headers:r,rawBody:a,body:n},n)}),(e=>{const{message:s,response:o}=e;t(s,o,o&&i.decode(o.rawBody,this.encoding))}));break}}time(e,t=null){const s=t?new Date(t):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let t in i)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?i[t]:("00"+i[t]).substr((""+i[t]).length)));return e}queryStr(e){let t="";for(const s in e){let i=e[s];null!=i&&""!==i&&("object"==typeof i&&(i=JSON.stringify(i)),t+=`${s}=${i}&`)}return t=t.substring(0,t.length-1),t}msg(t=e,s="",i="",o={}){const r=e=>{const{$open:t,$copy:s,$media:i,$mediaMime:o}=e;switch(typeof e){case void 0:return e;case"string":switch(this.getEnv()){case"Surge":case"Stash":default:return{url:e};case"Loon":case"Shadowrocket":return e;case"Quantumult X":return{"open-url":e};case"Node.js":return}case"object":switch(this.getEnv()){case"Surge":case"Stash":case"Shadowrocket":default:{const r={};let a=e.openUrl||e.url||e["open-url"]||t;a&&Object.assign(r,{action:"open-url",url:a});let n=e["update-pasteboard"]||e.updatePasteboard||s;n&&Object.assign(r,{action:"clipboard",text:n});let h=e.mediaUrl||e["media-url"]||i;if(h){let e,t;if(h.startsWith("http"));else if(h.startsWith("data:")){const[s]=h.split(";"),[,i]=h.split(",");e=i,t=s.replace("data:","")}else{e=h,t=(e=>{const t={JVBERi0:"application/pdf",R0lGODdh:"image/gif",R0lGODlh:"image/gif",iVBORw0KGgo:"image/png","/9j/":"image/jpg"};for(var s in t)if(0===e.indexOf(s))return t[s];return null})(h)}Object.assign(r,{"media-url":h,"media-base64":e,"media-base64-mime":o??t})}return Object.assign(r,{"auto-dismiss":e["auto-dismiss"],sound:e.sound}),r}case"Loon":{const s={};let o=e.openUrl||e.url||e["open-url"]||t;o&&Object.assign(s,{openUrl:o});let r=e.mediaUrl||e["media-url"]||i;return r&&Object.assign(s,{mediaUrl:r}),console.log(JSON.stringify(s)),s}case"Quantumult X":{const o={};let r=e["open-url"]||e.url||e.openUrl||t;r&&Object.assign(o,{"open-url":r});let a=e.mediaUrl||e["media-url"]||i;a&&Object.assign(o,{"media-url":a});let n=e["update-pasteboard"]||e.updatePasteboard||s;return n&&Object.assign(o,{"update-pasteboard":n}),console.log(JSON.stringify(o)),o}case"Node.js":return}default:return}};if(!this.isMute)switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":default:$notification.post(t,s,i,r(o));break;case"Quantumult X":$notify(t,s,i,r(o));break;case"Node.js":break}if(!this.isMuteLog){let e=["","==============📣系统通知📣=============="];e.push(t),s&&e.push(s),i&&e.push(i),console.log(e.join("\n")),this.logs=this.logs.concat(e)}}debug(...e){this.logLevels[this.logLevel]<=this.logLevels.debug&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.debug}${e.map((e=>e??String(e))).join(this.logSeparator)}`))}info(...e){this.logLevels[this.logLevel]<=this.logLevels.info&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.info}${e.map((e=>e??String(e))).join(this.logSeparator)}`))}warn(...e){this.logLevels[this.logLevel]<=this.logLevels.warn&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.warn}${e.map((e=>e??String(e))).join(this.logSeparator)}`))}error(...e){this.logLevels[this.logLevel]<=this.logLevels.error&&(e.length>0&&(this.logs=[...this.logs,...e]),console.log(`${this.logLevelPrefixs.error}${e.map((e=>e??String(e))).join(this.logSeparator)}`))}log(...e){e.length>0&&(this.logs=[...this.logs,...e]),console.log(e.map((e=>e??String(e))).join(this.logSeparator))}logErr(e,t){switch(this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:this.log("",`❗️${this.name}, 错误!`,t,e);break;case"Node.js":this.log("",`❗️${this.name}, 错误!`,t,void 0!==e.message?e.message:e,e.stack);break}}wait(e){return new Promise((t=>setTimeout(t,e)))}done(e={}){const t=((new Date).getTime()-this.startTime)/1e3;switch(this.log("",`🔔${this.name}, 结束! 🕛 ${t} 秒`),this.log(),this.getEnv()){case"Surge":case"Loon":case"Stash":case"Shadowrocket":case"Quantumult X":default:$done(e);break;case"Node.js":process.exit(1)}}}(e,t)}